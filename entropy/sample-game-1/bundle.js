(()=>{"use strict";var t,e,i,n,s,o,a,r={};r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t})();class h{constructor(t,e){this.unsubscribeLogic=t,this.handler=e}get isActive(){return null!==this.unsubscribeLogic&&null!==this.handler}publish(t){this.handler&&this.handler(t)}unsubscribe(){this.unsubscribeLogic&&(this.unsubscribeLogic(this),this.unsubscribeLogic=null,this.handler=null)}}class l{constructor(){this.subscriptions=[]}publish(t){this.subscriptions.forEach((e=>e.publish(t)))}subscribe(t){const e=new h((t=>this.unsubscribe(t)),t);return this.subscriptions.push(e),e}unsubscribe(t){return class{static removeItemFromArray(t,e){const i=t.indexOf(e);return i>=0&&(t.splice(i,1),!0)}}.removeItemFromArray(this.subscriptions,t)}unsubscribeAll(){this.subscriptions.forEach((t=>t.unsubscribe()))}}class c{constructor(t,e=!0){this.isEnabled=!0,this._onDestroyed=new l,this.gameObject=t,this.enabled=e}set enabled(t){t!==this.isEnabled&&(this.isEnabled=t,t?this.onEnabled():this.onDisable())}get enabled(){return!!this.gameObject.enabled&&this.isEnabled}get tag(){return this.gameObject.tag}get id(){return this.gameObject.id}get transform(){return this.gameObject.transform}get onDestroyed(){return this._onDestroyed}onEnabled(){}start(){}update(){this.gameObject.removeComponentFromUpdate(this)}onDisable(){}onDestroy(){this._onDestroyed.publish(this)}hasComponent(t){return this.gameObject.hasComponent(t)}getComponent(t){return this.gameObject.getComponent(t)}getComponents(t){return this.gameObject.getComponents(t)}getComponentInParent(t){return this.gameObject.getComponentInParent(t)}getComponentsInParent(t){return this.gameObject.getComponentsInParent(t)}getComponentInChildren(t){return this.gameObject.getComponentInChildren(t)}getComponentsInChildren(t){return this.gameObject.getComponentsInChildren(t)}addComponent(t){return this.gameObject.addComponent(t)}removeComponent(t){this.gameObject.removeComponent(t)}get input(){return this.gameObject.input}get time(){return this.gameObject.time}get assetPool(){return this.gameObject.assetPool}get sceneManager(){return this.gameObject.sceneManager}get physics(){return this.gameObject.physics}get gameCanvas(){return this.gameObject.gameCanvas}get terrain(){return this.gameObject.terrain}findGameObjectById(t){return this.gameObject.findGameObjectById(t)}findGameObjectWithTag(t){return this.gameObject.findGameObjectWithTag(t)}findGameObjectsWithTag(t){return this.gameObject.findGameObjectsWithTag(t)}instantiate(t,e,i,n){return this.gameObject.instantiate(t,e,i,n)}destroy(t,e=0){this.gameObject.destroy(t,e)}invoke(t,e){this.gameObject.invoke(t,e)}invokeRepeating(t,e,i){this.gameObject.invokeRepeating(t,e,i)}}class d{constructor(t,e){this.x=0,this.y=0,this.x=t,this.y=e}static get up(){return new d(0,-1)}static get down(){return new d(0,1)}static get left(){return new d(-1,0)}static get right(){return new d(1,0)}static get zero(){return new d(0,0)}static get one(){return new d(1,1)}static clone(t){return new d(t.x,t.y)}static fromString(t){if(t.split(",").length<2)throw new Error(`${t} is invalid format. It should be x,y (eg: 5,6)`);const e=Number(t.split(",")[0]),i=Number(t.split(",")[1]);return new d(e,i)}static add(t,e){return new d(t.x+e.x,t.y+e.y)}static subtract(t,e){return new d(t.x-e.x,t.y-e.y)}static multiply(t,e){return new d(t.x*e.x,t.y*e.y)}static divide(t,e){return 0!==e.x&&0!==e.y||console.warn("Attempting to divide by 0!"),new d(t.x/e.x,t.y/e.y)}static multiplyScalar(t,e){return new d(t.x*e,t.y*e)}static divideScalar(t,e){return 0===e&&console.warn("Attempting to divide by 0!"),new d(t.x/e,t.y/e)}static distance(t,e){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}static distanceSqrd(t,e){const i=t.x-e.x,n=t.y-e.y;return i*i+n*n}static manhattanDistance(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}static angleInRadians(t,e){const i=d.dot(t,e)/(t.magnitude*e.magnitude);return Math.acos(i)}static angleInDegrees(t,e){return 180*this.angleInRadians(t,e)/Math.PI}static dot(t,e){return t.x*e.x+t.y*e.y}static direction(t,e){return new d(e.x-t.x,e.y-t.y).normalized}static normalize(t){const{magnitude:e}=t;return 0===e?t:t.divide(new d(e,e))}get sqrMagnitude(){return this.x*this.x+this.y*this.y}get magnitude(){return Math.sqrt(this.sqrMagnitude)}get normalized(){const{magnitude:t}=this;return 0===t?d.zero:d.divide(this,new d(t,t))}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}divide(t){return 0!==t.x&&0!==t.y||console.warn("Attempting to divide by 0!"),this.x/=t.x,this.y/=t.y,this}equals(t,e){return"number"==typeof t?this.x===t&&this.y===e:this.x===t.x&&this.y===t.y}isCloseTo(t,e=1){const i=Math.abs(this.x-t.x)<=e,n=Math.abs(this.y-t.y)<=e;return i&&n}multiplyScalar(t){return this.x*=t,this.y*=t,this}divideScalar(t){return 0===t&&console.warn("Attempting to divide by 0!"),this.x/=t,this.y/=t,this}zero(){return this.x=0,this.y=0,this}clone(){return new d(this.x,this.y)}toString(){return`${this.x},${this.y}`}}class u extends c{constructor(t,e=70,i=!1){super(t),this.velocity=d.zero,this._isKinomatic=!1,this.forces=[],this._becameKinomatic=new l,this._becameNonKinomatic=new l,this._mass=e,this._inverseMass=0!==e?1/e:0,this.isKinomatic=i}set mass(t){this._mass=t,this._inverseMass=0!==t?1/t:0}get mass(){return 0===this._mass?1/0:this._mass}get inverseMass(){return this._inverseMass}set isKinomatic(t){this._isKinomatic=t,t?this._becameKinomatic.publish(this):this._becameNonKinomatic.publish(this)}get isKinomatic(){return this._isKinomatic}get becameKinomatic(){return this._becameKinomatic}get becameNonKinomatic(){return this._becameNonKinomatic}updatePhysics(){this.forces.forEach((t=>this.velocity.add(t.divideScalar(this.mass)))),this.forces.length=0,this.transform.translate(this.velocity)}addForce(t){this.forces.push(t)}}(a=t||(t={})).Red="#F44336",a.Pink="#E91E63",a.Purple="#9C27B0",a.DeepPurple="#673AB7",a.Indigo="#3F51B5",a.Blue="#2196F3",a.LightBlue="#03A9F4",a.Cyan="#00BCD4",a.Teal="#009688",a.Green="#4CAF50",a.LightGreen="#2fff0f",a.Lime="#CDDC39",a.Yellow="#FFEB3B",a.Amber="#FFC107",a.Orange="#FF9800",a.DeepOrange="#FF5722",a.Brown="#795548",a.RedGrey="#635c5c",a.BlueGrey="#607D8B",a.Grey="#9E9E9E",a.White="#FFFFFF",a.Black="#000000";class p{constructor(t,e,i){this.dynamicFriction=t,this.staticFriction=e,this.bounciness=i}static get ice(){return new p(.1,.1,0)}static get bouncy(){return new p(.3,.3,1)}static get maxFriction(){return new p(1,1,0)}static get metal(){return new p(.15,.15,.597)}static get rubber(){return new p(1,1,.828)}static get wood(){return new p(.45,.45,.603)}static get zero(){return new p(0,0,0)}}class m extends c{constructor(t,e,i,n,s=0,o=0){super(t),this.isTrigger=!1,this.physicalMaterial=p.zero,this._onCollided=new l,this._onResize=new l,this._width=i,this._height=n,this._offset=new d(s,o),this.attachedRigidbody=e;const{transform:a}=this;this._topLeft=new d(a.position.x+this._offset.x-i/2,a.position.y+this._offset.y-n),this._topRight=new d(a.position.x+this._offset.x+i/2,a.position.y+this._offset.y-n),this._bottomLeft=new d(a.position.x+this._offset.x-i/2,a.position.y+this._offset.y),this._bottomRight=new d(a.position.x+this._offset.x+i/2,a.position.y+this._offset.y)}get width(){return this._width}set width(t){this._width=t,this._onResize.publish()}get height(){return this._height}set height(t){this._height=t,this._onResize.publish()}get offset(){return this._offset}set offset(t){this._offset=t,this._onResize.publish()}get topLeft(){return this._topLeft.x=this.transform.position.x+this._offset.x-this._width/2,this._topLeft.y=this.transform.position.y+this._offset.y-this._height,this._topLeft}get topRight(){return this._topRight.x=this.transform.position.x+this._offset.x+this._width/2,this._topRight.y=this.transform.position.y+this._offset.y-this._height,this._topRight}get bottomLeft(){return this._bottomLeft.x=this.transform.position.x+this._offset.x-this._width/2,this._bottomLeft.y=this.transform.position.y+this._offset.y,this._bottomLeft}get bottomRight(){return this._bottomRight.x=this.transform.position.x+this._offset.x+this._width/2,this._bottomRight.y=this.transform.position.y+this._offset.y,this._bottomRight}get center(){return new d(this.topLeft.x+this._width/2,this.topLeft.y+this._height/2)}get onCollided(){return this._onCollided}get onResized(){return this._onResize}detectCollision(t){return!(t.topLeft.x>this.topRight.x||t.topRight.x<this.topLeft.x||t.topLeft.y>this.bottomLeft.y||t.bottomLeft.y<this.topLeft.y)}triggerCollision(t){this._onCollided.publish(t)}renderGizmo(e){e.beginPath(),e.moveTo(this.topLeft.x,this.topLeft.y),e.lineTo(this.bottomLeft.x,this.bottomLeft.y),e.lineTo(this.bottomRight.x,this.bottomRight.y),e.lineTo(this.topRight.x,this.topRight.y),e.lineTo(this.topLeft.x,this.topLeft.y),e.strokeStyle=t.LightGreen,e.stroke()}}class g{constructor(t,e,i){this.addNonKinomaticRigidbody=t=>{if(void 0===t)throw new Error("Invalid input");this.rigidbodies.push(t)},this.removeKinomaticRigidbody=t=>{if(!(t instanceof u))throw new Error("Invalid component passed in");const e=this.rigidbodies.indexOf(t);-1!==e&&this.rigidbodies.splice(e,1)},this.removeColliderFromDetector=t=>{t instanceof m?this.collisionDetector.removeCollider(t):console.error("Invalid component. Expecting RectangleCollider")},this.rigidbodies=[],this.gravity=665,this.collisionDetector=t,this.collisionResolver=e,this.collisionDetector.onCollisionDetected.subscribe((t=>this.resolveCollisions(t))),this.time=i}get colliders(){return this.collisionDetector.colliders}getPossibleColliders(t,e){return[]}updatePhysics(){this.collisionDetector.detectCollisions(),this.rigidbodies.forEach((t=>{t.addForce(d.down.multiplyScalar(this.gravity).multiplyScalar(this.time.deltaTime)),t.updatePhysics()}))}addRigidbody(t){t.isKinomatic||this.rigidbodies.push(t),t.becameKinomatic.subscribe(this.removeKinomaticRigidbody),t.becameNonKinomatic.subscribe(this.addNonKinomaticRigidbody),t.onDestroyed.subscribe(this.removeKinomaticRigidbody)}addCollider(t){this.collisionDetector.addCollider(t),t.onDestroyed.subscribe(this.removeColliderFromDetector)}resolveCollisions(t){if(void 0===t)throw new Error("Invalid");this.collisionResolver.resolveCollisions(t)}}class f extends c{constructor(t,e,i,n=0,s=null){super(t),this._parent=null,this.parentOnMoved=null,this._children=[],this.onMove=new l,this.updatePositionBasedOnParent=()=>{null!==this._parent&&this.setPosition(this._parent.position.x+this.localPosition.x,this._parent.position.y+this.localPosition.y)},this.position=new d(e,i),this.localPosition=d.zero,this.rotation=n,this.parent=s,this.scale=d.one}get onMoved(){return this.onMove}get parent(){return this._parent}set parent(t){var e;null!==this._parent&&(this._parent._children.splice(this._parent._children.indexOf(this),1),null===(e=this.parentOnMoved)||void 0===e||e.unsubscribe(),this.parentOnMoved=null),null!==t?(t._children.push(this),this.parentOnMoved=t.onMoved.subscribe(this.updatePositionBasedOnParent),this.localPosition.x=this.position.x-t.position.x,this.localPosition.y=this.position.y-t.position.y):(this.localPosition.x=0,this.localPosition.y=0),this._parent=t}get children(){return[...this._children]}translate(t){this.position.add(t),this.onMove.publish()}lookAt(t){this.rotation=Math.atan2(t.y-this.position.y,t.x-this.position.x)-Math.PI/2}setPosition(t,e){this.position.x=t,this.position.y=e,this.onMove.publish()}isChildOf(t){if(t===this)return!0;let e=this.parent;for(;null!==e;){if(e===t)return!0;e=e.parent}return!1}}class y{constructor(t){this.updatableComponents=[],this.componentMap=new Map;const{gameEngine:e,id:i,x:n,y:s,rotation:o,tag:a,layer:r}=t;this.gameEngine=e,this.isEnabled=!0,this.componentAnalyzer=e.componentAnalyzer;const h=this.getPrefabSettings();this.id=i||h.id,this.transform=new f(this,n||h.x,s||h.y),this.transform.rotation=o||h.rotation,this.tag=a||h.tag,this.layer=r||h.layer;const l=this.buildInitialComponents(t);l.push(this.transform),this.setComponents(l);const c=this.buildAndReturnChildGameObjects(t);for(const t of c)t.transform.parent=this.transform}get enabled(){return this.isEnabled}set enabled(t){if(t!==this.isEnabled){this.isEnabled=t;for(const e of this.updatableComponents)e.enabled&&(t?e.onEnabled():e.onDisable())}}get input(){return this.gameEngine.input}get physics(){return this.gameEngine.physics}get sceneManager(){return this.gameEngine.sceneManager}get assetPool(){return this.gameEngine.assetPool}get time(){return this.gameEngine.time}get gameCanvas(){return this.gameEngine.gameCanvas}get gameCanvasContext(){return this.gameEngine.canvasContext}get terrain(){return this.gameEngine.terrain}start(){this.updatableComponents.forEach((t=>t.start()))}update(){for(const t of this.updatableComponents)t.enabled&&t.update()}findGameObjectById(t){return this.gameEngine.findGameObjectById(t)}findGameObjectWithTag(t){return this.gameEngine.findGameObjectWithTag(t)}findGameObjectsWithTag(t){return this.gameEngine.findGameObjectsWithTag(t)}instantiate(t,e,i,n){return this.gameEngine.instantiate(t,e,i,n)}destroy(t,e=0){this.gameEngine.destroy(t,e)}invoke(t,e){this.gameEngine.invoke(t,e)}invokeRepeating(t,e,i){this.gameEngine.invokeRepeating(t,e,i)}removeComponentFromUpdate(t){if(!this.componentMap.has(t.constructor.name))throw new Error(`This game object does not have a component of type ${t.constructor.name}`);if(!this.updatableComponents.includes(t))throw new Error("This game object does not have the component being removed.");this.updatableComponents.splice(this.updatableComponents.indexOf(t),1)}hasComponent(t){return this.componentMap.has(t.name)}getComponent(t){const e=t.name,i=this.componentMap.get(e);return void 0===i||0===i.length?null:i[0]}getComponents(t){const e=t.name,i=this.componentMap.get(e);return void 0===i||0===i.length?[]:[...i]}getComponentInParent(t){let{parent:e}=this.transform;for(;null!==e;){if(e.hasComponent(t))return e.getComponent(t);e=e.parent}return null}getComponentsInParent(t){let{parent:e}=this.transform;const i=[];for(;null!==e;){if(e.hasComponent(t)){const n=e.getComponent(t);if(null===n)throw new Error("Error getting parent component");i.push(n)}e=e.parent}return i}getComponentInChildren(t){const{children:e}=this.transform;for(;e.length>0;){const i=e.pop();if(void 0===i)throw new Error("Error getting child.");if(i.hasComponent(t))return i.getComponent(t);for(const t of i.children)e.push(t)}return null}getComponentsInChildren(t){const{children:e}=this.transform,i=[];for(;e.length>0;){const n=e.pop();if(void 0===n)throw new Error("Error getting child");if(n.gameObject.hasComponent(t)){const e=n.getComponent(t);if(null===e)throw new Error("Error getting child component.");i.push(e)}for(const t of n.children)e.push(t)}return i}addComponent(t){const e=this.componentMap.get(t.constructor.name);return void 0!==e?e.push(t):this.componentMap.set(t.constructor.name,[t]),this.componentAnalyzer.extractRenderablesCollidersAndRigidbodies(t),t.enabled=!0,t.start(),t}removeComponent(t){if(!this.componentMap.has(t.constructor.name))throw new Error(`This object does not have a ${t.constructor.name} component!`);this.updatableComponents.splice(this.updatableComponents.indexOf(t),1),this.componentMap.delete(t.constructor.name),t.onDestroy()}onDestroy(){for(const t of this.componentMap.values())for(const e of t)e.onDestroy()}buildAndReturnChildGameObjects(t){return[]}setComponents(t){for(const e of t){this.updatableComponents.push(e);const t=this.componentMap.get(e.constructor.name);void 0!==t?t.push(e):this.componentMap.set(e.constructor.name,[e]),this.componentAnalyzer.extractRenderablesCollidersAndRigidbodies(e)}}}class w{constructor(){this._deltaTime=0,this._totalTime=0,this.prevTime=null}get deltaTime(){return this._deltaTime}get totalTime(){return this._totalTime}updateTime(t){null===this.prevTime&&(this.prevTime=t),this._deltaTime=(t-this.prevTime)/1e3,this.prevTime=t,this._totalTime+=this._deltaTime}}class b{constructor(t){this._canvasContext=t,this.renderableObjects=[],this.renderableGizmos=[],this.renderableGUIElements=[],this.renderGizmos=!1,this._terrain=null,this._background=null}set terrain(t){this._terrain=t}set background(t){this._background=t}get canvasContext(){return this._canvasContext}addRenderableObject(t){this.renderableObjects.push(t),t instanceof c&&t.onDestroyed.subscribe((()=>{const e=this.renderableObjects.indexOf(t);-1!==e&&this.renderableObjects.splice(e,1)}))}addRenderableGizmo(t){this.renderableGizmos.push(t),t instanceof c&&t.onDestroyed.subscribe((()=>{const e=this.renderableGizmos.indexOf(t);-1!==e&&this.renderableGizmos.splice(e,1)}))}addRenderableGUIElement(t){this.renderableGUIElements.push(t),this.renderableGUIElements.sort((t=>t.zIndex||0)),t instanceof c&&t.onDestroyed.subscribe((()=>{const e=this.renderableGUIElements.indexOf(t);-1!==e&&this.renderableGUIElements.splice(e,1)}))}renderScene(){null!==this._background&&this._background.renderBackground(this._canvasContext),null!==this._terrain&&this._terrain.renderBackground(this._canvasContext);for(const t of this.renderableObjects)t.enabled&&t.render(this._canvasContext);if(this.renderGizmos)for(const t of this.renderableGizmos)t.enabled&&t.renderGizmo(this._canvasContext);for(const t of this.renderableGUIElements)t.enabled&&t.renderGUI(this._canvasContext)}}class S{constructor(t){this.cells=new Map,this.unpassableCells=new Set,this.cellSize=t,this.directions=[d.up.multiplyScalar(t),d.right.multiplyScalar(t),d.down.multiplyScalar(t),d.left.multiplyScalar(t)]}get graphCells(){return[...this.cells.values()]}*neighbors(t){for(const e of this.directions){const i=this.getMapKey(t.x+e.x,t.y+e.y),n=this.cells.get(i);this.unpassableCells.has(i)||void 0===n||(yield n)}}getCell(t,e){const i=this.getMapKey(t,e),n=this.cells.get(i);if(void 0===n)throw new Error("Cell does not exist.");return n}cost(t,e){const i=this.getMapKey(e),n=this.cells.get(i);if(void 0===n)throw new Error("Cell does not exist");return n.weight}addCell(t){const e=this.getMapKey(t.position);this.cells.has(e)&&console.error(`WARNING! ${e} alread in cells set!`),this.cells.set(e,t),t.passable||this.unpassableCells.add(e)}isUnpassable(t){const e=this.getMapKey(t);return!!this.unpassableCells.has(e)}getMapKey(t,e){if("number"==typeof t){if(void 0===e)throw new Error("y must not be undefined.");return`${Math.floor(t/this.cellSize)*this.cellSize},${Math.floor(e/this.cellSize)*this.cellSize}`}return`${Math.floor(t.x/this.cellSize)*this.cellSize},${Math.floor(t.y/this.cellSize)*this.cellSize}`}}!function(t){t[t.Default=1]="Default",t[t.Terrain=2]="Terrain",t[t.Water=3]="Water",t[t.Hostile=4]="Hostile",t[t.Neutral=5]="Neutral",t[t.Friendly=6]="Friendly",t[t.UI=7]="UI"}(e||(e={}));class A extends y{constructor(t,e,i,n){super({gameEngine:t}),this.terrainImage=e,this.navGrid=i;const s=new Map;for(const t of n){const e=s.get(t.y);if(void 0===e){s.set(t.y,new Map);const e=s.get(t.y);if(void 0===e)throw new Error("Something went horribly wrong.");e.set(t.x,[t,i.cellSize])}else{const n=e.get(t.x-i.cellSize);if(void 0!==n){const s=n[1]+i.cellSize,o=n[0];e.delete(t.x-i.cellSize),e.set(t.x,[o,s])}else e.set(t.x,[t,i.cellSize])}}for(const t of s.values())for(const e of t.values())this.addComponent(new m(this,null,e[1],i.cellSize,e[0].x+e[1]/2,e[0].y+i.cellSize))}renderBackground(t){t.drawImage(this.terrainImage,0,0)}buildInitialComponents(){return[]}getPrefabSettings(){return{x:0,y:0,rotation:0,id:"terrain",tag:"terrain",layer:e.Terrain}}}class v{constructor(t=1024,e=576){this.builderMap=new Map,this.spriteSheetSet=new Set,this.currentSpriteSheet=null,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e;const i=this.canvas.getContext("2d");if(null===i)throw new Error("Bad context");this.context=i}async buildTerrain(t,e){return await this.using(e.spriteSheetUrl),new Promise((i=>{const{scale:n}=e,s=e.getSpec(),{cellSize:o}=e,a=new S(o*n),r=[];let h=0,l=0;for(let t=0;t<s.length;t++)for(let e=0;e<s[t].length;e++){const i=s[t][e];if(null===i){h=e===s[t].length-1?0:h+o*n,l=e===s[t].length-1?l+o*n:l;continue}a.addCell({passable:i.passable,weight:i.weight,position:new d(h,l)}),i.passable||r.push(new d(h,l));const c=i.spriteData;if(null===this.currentSpriteSheet)throw new Error("Error building terrain.");this.context.drawImage(this.currentSpriteSheet,c.sliceX,c.sliceY,c.sliceWidth,c.sliceHeight,h,l,c.sliceWidth*n,c.sliceHeight*n),h=e===s[t].length-1?0:h+c.sliceWidth*n,l=e===s[t].length-1?l+c.sliceHeight*n:l}const c=new Image;c.src=this.canvas.toDataURL(),c.onload=()=>{i(new A(t,c,a,r))}}))}async using(t){return this.spriteSheetSet.has(t)&&console.warn("This builder is already using this sprite sheet!"),new Promise((e=>{this.spriteSheetSet.add(t);const i=new Image;i.src=t,i.onload=()=>{this.builderMap.set(i,new Map),this.currentSpriteSheet=i,e(this)}}))}}!function(t){t.KeyDown="keydown",t.KeyUp="keyup",t.KeyPress="keypress",t.AuxClick="auxclick",t.Click="click",t.ContextMenu="contextmenu",t.DoubleClick="dblclick",t.MouseDown="mousedown",t.MouseEnter="mouseenter",t.MouseLeave="mouseleave",t.MouseMove="mousemove",t.MouseOver="mouseover",t.MouseOut="mouseout",t.MouseUp="mouseup",t.PointerLockChange="pointerlockchange",t.PointerLockError="pointerlockerror",t.Select="select",t.Wheel="wheel",t.Error="error",t.Abort="abort",t.Load="load",t.BeforeUnload="beforeunload",t.Unload="unload",t.Online="online",t.Offline="offline",t.Focus="focus",t.Blur="blur"}(i||(i={}));class M{constructor(t){this.previousKeyHandled=null,this.keyMap=new Map,this.mouseMap=new Map,this.genericEventMap=new Map,this.currentListeners=new Map,this.reservedEvents=new Set([i.Click,i.KeyDown,i.KeyUp]),this.keyDownSet=new Set,this.mouseButtonDownSet=new Set,this.currentMousePosition=d.zero,this.invokeGenericHandlers=t=>{const e=this.genericEventMap.get(t.type);void 0!==e&&e.forEach((e=>e(t)))},this.invokeKeyHandlers=t=>{if(!(t instanceof KeyboardEvent))return void console.error("Invalid event");const e=t.type;if(e===i.KeyDown){if(this.previousKeyHandled===t.key)return;this.previousKeyHandled=t.key}if(!this.keyMap.has(e))return;const n=this.keyMap.get(e);if(void 0===n)throw new Error("Invalid event type.");const s=n.get(t.key);void 0!==s&&s.forEach((e=>e(t)))},this.invokeMouseHandlers=t=>{if(!(t instanceof MouseEvent))return void console.log("Invalid event.");const e=t.type;if(!this.mouseMap.has(e))return;const i=t;this.updateCursorPosition(t),i.cursorPositionOnCanvas=this.canvasMousePosition;const n=this.mouseMap.get(e);if(void 0===n)throw new Error("Invalid event type");const s=n.get(t.button);void 0!==s&&s.forEach((t=>t(i)))},this.updateCursorPosition=t=>{this.currentMousePosition.x=t.clientX,this.currentMousePosition.y=t.clientY},this.updateKeyDownSet=t=>{"keydown"===t.type?this.keyDownSet.add(t.key):"keyup"===t.type&&(this.previousKeyHandled=null,this.keyDownSet.delete(t.key))},this.updateMouseDownSet=t=>{"mousedown"===t.type?this.mouseButtonDownSet.add(t.button):"mouseup"===t.type&&this.mouseButtonDownSet.delete(t.button)},this.updateBoundingClientRect=()=>{this.boundingRect=this.gameCanvas.getBoundingClientRect()},this.gameCanvas=t,this.boundingRect=t.getBoundingClientRect(),document.addEventListener("keydown",this.updateKeyDownSet),document.addEventListener("keyup",this.updateKeyDownSet),document.addEventListener("mousedown",this.updateMouseDownSet),document.addEventListener("mouseup",this.updateMouseDownSet),document.addEventListener("mousemove",this.updateCursorPosition),window.addEventListener("resize",this.updateBoundingClientRect),window.addEventListener("scroll",this.updateBoundingClientRect)}get canvasMousePosition(){return new d(this.currentMousePosition.x-this.boundingRect.left,this.currentMousePosition.y-this.boundingRect.top)}addEventListener(t,e){if(this.reservedEvents.has(t))return void console.error(`${t} is a reserved event. Please use the correct method to add a listener for it.`);const i=this.genericEventMap.get(t);void 0!==i?i.push(e):(this.currentListeners.has(t)||(document.addEventListener(t,this.invokeGenericHandlers),this.currentListeners.set(t,this.invokeGenericHandlers)),this.genericEventMap.set(t,[e]))}addKeyListener(t,e,i){this.currentListeners.has(t)||(document.addEventListener(t,this.invokeKeyHandlers),this.currentListeners.set(t,this.invokeKeyHandlers)),this.keyMap.has(t)||this.keyMap.set(t,new Map),"string"==typeof e&&(e=[e]);for(const n of e){const e=this.keyMap.get(t);if(void 0===e)throw new Error("Invalid key");const s=e.get(n);void 0!==s?s.push(i):e.set(n,[i])}}addMouseListener(t,e,i){this.currentListeners.has(t)||(document.addEventListener(t,this.invokeMouseHandlers),this.currentListeners.set(t,this.invokeMouseHandlers)),this.mouseMap.has(t)||this.mouseMap.set(t,new Map);const n=this.mouseMap.get(t);if(void 0===n)throw new Error("Missing type");if(n.has(e)){const t=n.get(e);void 0!==t&&t.push(i)}else n.set(e,[i])}getKey(t){return this.keyDownSet.has(t)}getMouseButton(t){return this.mouseButtonDownSet.has(t)}clearListeners(){this.keyMap.clear(),this.mouseMap.clear(),this.genericEventMap.clear(),this.currentListeners.forEach(((t,e)=>{document.removeEventListener(e,t)})),document.removeEventListener("keydown",this.updateKeyDownSet),document.removeEventListener("keyup",this.updateKeyDownSet),document.removeEventListener("mousedown",this.updateMouseDownSet),document.removeEventListener("mouseup",this.updateMouseDownSet),document.removeEventListener("mousemove",this.updateCursorPosition),window.removeEventListener("resize",this.updateBoundingClientRect),window.removeEventListener("scroll",this.updateBoundingClientRect),this.currentListeners.clear()}}class C{constructor(t,e){this.physicsEngine=t,this.renderingEngine=e}extractRenderablesCollidersAndRigidbodies(t){t instanceof u?this.physicsEngine.addRigidbody(t):t instanceof m&&this.physicsEngine.addCollider(t),"function"==typeof t.render?this.renderingEngine.addRenderableObject(t):"function"==typeof t.renderGUI?this.renderingEngine.addRenderableGUIElement(t):"function"==typeof t.renderGizmo&&this.renderingEngine.addRenderableGizmo(t)}}class x{constructor(t){this.gameEngine=t}get loadedSceneId(){return this.gameEngine.loadedSceneId}async loadScene(t){await this.gameEngine.loadScene(t)}togglePause(){this.gameEngine.togglePause()}printGameData(){this.gameEngine.printGameData()}}class F{constructor(t,e,i,n){this.colliderA=t,this.colliderB=e,this.penetrationDepth=i,this.collisionNormal=n}getOtherCollider(t){return t===this.colliderA?this.colliderB:this.colliderA}getCollisionNormalForCollider(t){return t===this.colliderA?this.collisionNormal.clone():this.collisionNormal.clone().multiplyScalar(-1)}}class E extends class{constructor(t){this.colliders=[],this._onCollisionDetected=new l,this.layerCollisionMatrix=t}get onCollisionDetected(){return this._onCollisionDetected}addCollider(t){this.colliders.push(t)}removeCollider(t){const e=this.colliders.indexOf(t);-1!==e&&this.colliders.splice(e,1)}addColliders(t){t.forEach((t=>this.addCollider(t)))}buildCollisionManifold(t,e){const i=Math.abs(t.center.x-e.center.x),n=Math.abs(t.center.y-e.center.y),s=t.width/2+e.width/2,o=t.height/2+e.height/2,a=Math.abs(i-s),r=Math.abs(n-o),h=d.clone(t.center).subtract(e.center).normalized,l=a>r?r:a;return a>r?(h.x=0,h.y=h.y>0?1:-1):a<r&&(h.y=0,h.x=h.x>0?1:-1),new F(t,e,l,h)}}{constructor(t,e,i,n=100){super(i),this.colliderSpacialMapKeys=new Map,this.spatialMap=new Map,this.collisionMap=new Map,this.cellSize=n,this.gameMapWidth=t,this.gameMapHeight=e,this.buildSpatialMapCells()}get onCollisionDetected(){return this._onCollisionDetected}detectCollisions(){this.collisionMap.clear();for(const t of this.colliders)if(t.enabled)for(const e of this.getPossibleCollisions(t))if(t.detectCollision(e)){const i=this.collisionMap.get(t);void 0!==i?i.add(e):this.collisionMap.set(t,new Set([e]));const n=this.buildCollisionManifold(t,e);t.triggerCollision(n),e.triggerCollision(n),this._onCollisionDetected.publish(n)}}addCollider(t){t.transform.onMoved.subscribe((()=>this.updateColliderSpatialMapping(t))),t.onResized.subscribe((()=>this.updateColliderSpatialMapping(t))),this.colliders.push(t),this.updateColliderSpatialMapping(t)}removeCollider(t){const e=this.colliders.indexOf(t);if(-1!==e){this.colliders.splice(e,1);const i=this.colliderSpacialMapKeys.get(t);if(void 0===i)throw new Error("Keys not found for collider");for(const e of i){const i=this.spatialMap.get(e);if(void 0===i)throw new Error("Invalid cell key");i.delete(t)}this.colliderSpacialMapKeys.delete(t)}}getMapKey(t,e){if("number"==typeof t){if(void 0===e)throw new Error("y cannot be undefined when using x, y arguments.");return`${Math.floor(t/this.cellSize)*this.cellSize},${Math.floor(e/this.cellSize)*this.cellSize}`}return`${Math.floor(t.x/this.cellSize)*this.cellSize},${Math.floor(t.y/this.cellSize)*this.cellSize}`}buildSpatialMapCells(){this.spatialMap.clear();for(let t=0;t<this.gameMapWidth;t+=this.cellSize)for(let e=0;e<this.gameMapHeight;e+=this.cellSize)this.spatialMap.set(this.getMapKey(t,e),new Set)}updateColliderSpatialMapping(t){const e=this.getMapKey(t.topLeft),i=this.getMapKey(t.topRight),n=this.getMapKey(t.bottomLeft),s=this.getMapKey(t.bottomRight),o=new Set([e,i,n,s]);this.colliderSpacialMapKeys.has(t)||this.colliderSpacialMapKeys.set(t,new Set);const a=this.colliderSpacialMapKeys.get(t);if(void 0===a)throw new Error("Keys not found");let r=!1;if(o.size!==a.size)r=!0;else for(const t of o)if(!a.has(t)){r=!0;break}if(!r)return;for(const e of a){const i=this.spatialMap.get(e);if(void 0===i)throw new Error("Cell not found for given key.");i.delete(t)}if(a.clear(),e===s){const i=this.spatialMap.get(e);return void 0!==i?i.add(t):this.spatialMap.set(e,new Set([t])),void a.add(e)}const h=Number(e.split(",")[0]),l=Number(e.split(",")[1]),c=Number(i.split(",")[0])-h,d=Number(n.split(",")[1])-l;for(let e=h;e<=c+h;e+=this.cellSize)for(let i=l;i<=d+l;i+=this.cellSize){const n=this.getMapKey(e,i),s=this.spatialMap.get(n);void 0!==s?s.add(t):this.spatialMap.set(n,new Set([t])),a.add(n)}}getPossibleCollisions(t){const e=new Set,i=this.colliderSpacialMapKeys.get(t);if(void 0===i)return e;for(const n of i){const i=this.spatialMap.get(n);if(void 0!==i)for(const n of i){const i=this.layerCollisionMatrix.get(t.gameObject.layer);if(void 0===i)throw new Error("Layer not found");if(n!==t&&i.has(n.gameObject.layer)){const i=this.collisionMap.get(n);if(void 0!==i&&i.has(t))continue;e.add(n)}}}return e}}class k{resolveCollisions(t){const{colliderA:e}=t,{colliderB:i}=t;if(e.isTrigger||i.isTrigger)return;if(null===e.attachedRigidbody||null===i.attachedRigidbody)return;const{collisionNormal:n}=t,s=e.attachedRigidbody,o=i.attachedRigidbody,a=d.subtract(o.velocity,s.velocity),r=d.dot(a,n);if(r<0)return;let h=-1*(1+Math.min(e.physicalMaterial.bounciness,i.physicalMaterial.bounciness))*r;h/=s.inverseMass+o.inverseMass;const l=d.multiplyScalar(n,h);let c=a.clone();c.subtract(d.multiplyScalar(n,d.dot(a,n))),c.equals(0,0)||(c=c.normalized);let u=-1*d.dot(a,c);u/=1/s.mass+1/o.mass;const p=e.physicalMaterial.staticFriction**2+i.physicalMaterial.staticFriction**2;let m;if(Math.abs(u)<h*p)m=c.multiplyScalar(u);else{const t=e.physicalMaterial.dynamicFriction**2+i.physicalMaterial.dynamicFriction**2;m=c.multiplyScalar(h*t)}const g=s.mass+o.mass;s.isKinomatic||(s.addForce(d.multiplyScalar(l,o.mass/g*-1)),s.addForce(d.multiplyScalar(m,-1))),o.isKinomatic||(o.addForce(d.multiplyScalar(l,s.mass/g)),o.addForce(m)),this.positionalCorrection(s,o,n,t.penetrationDepth)}positionalCorrection(t,e,i,n){const s=Math.max(n-.01,0)/(t.inverseMass+e.inverseMass)*.2,o=i.clone().multiplyScalar(s);t.isKinomatic||t.transform.position.add(o.clone().multiplyScalar(t.inverseMass)),e.isKinomatic||e.transform.position.subtract(o.clone().multiplyScalar(e.inverseMass))}}class R{static onSegment(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}static orientation(t,e,i){const n=(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y);return 0===n?0:n>0?1:2}static doIntersect(t,e,i,n){const s=this.orientation(t,e,i),o=this.orientation(t,e,n),a=this.orientation(i,n,t),r=this.orientation(i,n,e);return s!==o&&a!==r||!(0!==s||!this.onSegment(t,i,e))||!(0!==o||!this.onSegment(t,n,e))||!(0!==a||!this.onSegment(i,t,n))||!(0!==r||!this.onSegment(i,e,n))}static doIntersectRectangle(t,e,i,n,s,o){return!!(this.doIntersect(t,e,i,n)||this.doIntersect(t,e,i,s)||this.doIntersect(t,e,s,o)||this.doIntersect(t,e,n,o))}static rectangleContainsPoint(t,e,i){return i.x>=t.x&&i.x<=e.x&&i.y>=t.y&&i.y<=e.y}}class L{constructor(t){this.physicsEngine=t}pointRaycastToScreen(t){for(const e of this.physicsEngine.colliders)if(R.rectangleContainsPoint(e.topLeft,e.bottomRight,t))return e;return null}raycast(t,e,i){let n=null;const s=this.raycastAll(t,e,i);let o=-10;for(const e of s){const i=d.distance(t,e.transform.position);i>o&&(n=e,o=i)}return n}raycastAll(t,e,i){const n=[],s=d.add(t,e.multiplyScalar(i));for(const e of this.physicsEngine.colliders)R.doIntersectRectangle(t,s,e.topLeft,e.topRight,e.bottomLeft,e.bottomRight)&&n.push(e);return n}sphereCast(){}overlapSphere(t,e,i){const n=[];for(const s of this.physicsEngine.colliders)void 0!==i&&s.gameObject.layer!==i||d.distance(t,s.transform.position)<=e&&n.push(s);return n}}class P{constructor(t){this.developmentMode=!0,this._physicsEngine=null,this._renderingEngine=null,this.loadedScene=null,this.gameLoopId=null,this.gameInitialized=!1,this.paused=!1,this.gameObjects=[],this._input=null,this._physics=null,this._assetPool=null,this._time=null,this._sceneManager=null,this._terrain=null,this._componentAnalyzer=null,this.gameObjectMap=new Map,this.gameObjectNumMap=new Map,this.tagMap=new Map,this.scenes=new Map,this.invokeTimeouts=new Set,this.gameObjectsMarkedForDelete=[],this._gameCanvas=t.gameCanvas,this.configuration=t,this.layerCollisionMatrix=new Map;const i=Object.keys(e).filter((t=>"number"==typeof e[t])).map((t=>Number(e[t])));for(const t of i)this.layerCollisionMatrix.set(t,new Set(i));const n=this.layerCollisionMatrix.get(e.Terrain);if(void 0===n)throw new Error("Error with layers");n.delete(e.Terrain)}get canvasContext(){const t=this.gameCanvas.getContext("2d");if(null===t)throw new Error("No context!");return t}get input(){if(null===this._input)throw new Error("Input is null");return this._input}get physics(){if(null===this._physics)throw new Error("Physics is null");return this._physics}get time(){if(null===this._time)throw new Error("Time is null");return this._time}get componentAnalyzer(){if(null===this._componentAnalyzer)throw new Error("Component Analyzer is null");return this._componentAnalyzer}get sceneManager(){if(null===this._sceneManager)throw new Error("Scene Manager Analyzer is null");return this._sceneManager}get terrain(){if(null===this._terrain)throw new Error("Terrain is null");return this._terrain}get assetPool(){if(null===this._assetPool)throw new Error("Asset pool is null");return this._assetPool}get gameCanvas(){return this._gameCanvas}get loadedSceneId(){if(null===this.loadedScene)throw new Error("No scene is currently loaded!");return this.loadedScene.loadOrder}instantiate(t,e,i,n){const s=new t({gameEngine:this});return void 0!==e&&s.transform.setPosition(e.x,e.y),void 0!==i&&(s.transform.rotation=i),void 0!==n&&(s.transform.parent=n),this.registerGameObject(s),s}destroy(t,e=0){if(0===e){this.gameObjectsMarkedForDelete.push(t);const{transform:{children:e}}=t;for(;e.length>0;){const t=e.pop();if(void 0===t)throw new Error("Error getting child");this.gameObjectsMarkedForDelete.push(t.gameObject);for(const i of t.children)e.push(i)}}else this.invoke((()=>{this.gameObjectsMarkedForDelete.push(t);const{transform:{children:e}}=t;for(;e.length>0;){const t=e.pop();if(void 0===t)throw new Error("Error getting child");this.gameObjectsMarkedForDelete.push(t.gameObject);for(const i of t.children)e.push(i)}}),e)}invoke(t,e){const i=window.setTimeout((()=>{t(),this.invokeTimeouts.delete(i)}),1e3*e);this.invokeTimeouts.add(i)}invokeRepeating(t,e,i){this.invoke((()=>{void 0!==i&&i.cancel||(t(),this.invokeRepeating(t,e,i))}),e)}findGameObjectById(t){const e=this.gameObjectMap.get(t);return void 0===e?null:e}findGameObjectWithTag(t){const e=this.tagMap.get(t);return void 0===e||0===e.length?null:e[0]}findGameObjectsWithTag(t){const e=this.tagMap.get(t);return void 0===e?[]:e}printGameData(){console.log(this),console.log(`Time since game start ${this.time.totalTime}s`),console.log(this.renderingEngine),console.log(this.physicsEngine),this.gameObjects.forEach((t=>console.log(t)))}togglePause(){this.paused=!this.paused}setScenes(t){for(const e of t)(this.scenes.has(e.loadOrder)||this.scenes.has(e.name))&&console.error(`Duplicate scene load orders or name detected ${e.loadOrder} ${e.name}`),this.scenes.set(e.loadOrder,e),this.scenes.set(e.name,e)}async loadScene(t){const e=this.scenes.get(t);if(void 0===e)throw new Error(`Scene ${t} not found.`);this.endCurrentScene(),this.createEnginesAndAPIs(),await this.initializeScene(e),this.loadedScene=e,this.startGame()}get physicsEngine(){if(null===this._physicsEngine)throw new Error("Physics Engine is null");return this._physicsEngine}get renderingEngine(){if(null===this._renderingEngine)throw new Error("Rendering Engine is null");return this._renderingEngine}removeReferencesToGameObject(t){this.gameObjectMap.has(t.id)&&this.gameObjectMap.delete(t.id);const e=this.gameObjects.indexOf(t);-1!==e&&this.gameObjects.splice(e,1);const i=this.tagMap.get(t.tag);if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}const n=this.gameObjectNumMap.get(t.id);void 0!==n&&(n>1?this.gameObjectNumMap.set(t.id,n-1):this.gameObjectNumMap.delete(t.id)),t.onDestroy()}registerGameObject(t){if(""===t.id&&(t.id=this.generateUniqueId()),this.gameObjectMap.has(t.id)){const e=t.id,i=this.gameObjectNumMap.get(e);if(void 0===i)throw new Error("Error in regitering the new game object");t.id+=` Clone(${i})`,this.gameObjectNumMap.set(e,i+1)}else this.gameObjectNumMap.set(t.id,1);const e=this.tagMap.get(t.tag);void 0!==e?e.push(t):this.tagMap.set(t.tag,[t]),this.gameObjectMap.set(t.id,t),this.gameObjects.push(t),t.start();for(const e of t.transform.children)this.registerGameObject(e.gameObject)}endCurrentScene(){if(null!==this.loadedScene){null!==this.gameLoopId&&(cancelAnimationFrame(this.gameLoopId),this.gameLoopId=null);for(const t of this.invokeTimeouts)window.clearTimeout(t);this.invokeTimeouts.clear(),this.input.clearListeners(),this.tagMap.clear(),this.gameObjectMap.clear(),this.gameObjectNumMap.clear(),this.gameObjects.length=0,this.gameObjectsMarkedForDelete.length=0,this.loadedScene=null,this._assetPool=null,this._componentAnalyzer=null,this._input=null,this._physics=null,this._sceneManager=null,this._terrain=null,this._time=null}}async initializeScene(t){this._assetPool=await t.getAssetPool();const{terrainSpec:e}=t;let i=[];if(null!==e){const t=new v(this._gameCanvas.width,this._gameCanvas.height),n=await t.buildTerrain(this,e);i.push(n),this.renderingEngine.terrain=n,this._terrain=n}i=[...i,...t.getStartingGameObjects(this)];const n=t.getSkybox(this);this.renderingEngine.background=n,n instanceof y&&i.push(n),this.setGameObjects(i),this.gameInitialized=!0}createEnginesAndAPIs(){const t=new w,e=this.configuration.collisionDetectorGenerator?this.configuration.collisionDetectorGenerator(this):new E(this._gameCanvas.width,this._gameCanvas.height,this.layerCollisionMatrix,100),i=this.configuration.collisionResolverGenerator?this.configuration.collisionResolverGenerator(this):new k;this._physicsEngine=new g(e,i,t),this._renderingEngine=new b(this.canvasContext),this.renderingEngine.renderGizmos=this.developmentMode,this._input=new M(this._gameCanvas),this._componentAnalyzer=new C(this.physicsEngine,this.renderingEngine),this._sceneManager=new x(this),this._time=t,this._physics=new L(this.physicsEngine)}setGameObjects(t){this.gameObjects=[...t];for(const t of this.gameObjects){if(this.gameObjectMap.has(t.id)){const e=t.id,i=this.gameObjectNumMap.get(e);if(void 0===i)throw new Error("Error setting up initial game objects.");t.id+=` Clone(${i})`,this.gameObjectNumMap.set(e,i+1)}else this.gameObjectNumMap.set(t.id,1);this.gameObjectMap.set(t.id,t);const e=this.tagMap.get(t.tag);void 0!==e?e.push(t):this.tagMap.set(t.tag,[t]);const{transform:{children:i}}=t;for(;i.length>0;){const t=i.pop();if(void 0===t)throw new Error("Error getting child");this.gameObjects.push(t.gameObject);for(const e of t.children)i.push(e)}}}generateUniqueId(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}startGame(){if(!this.gameInitialized)throw new Error("The game is not initialized yet!");this.paused=!1,this.gameObjects.forEach((t=>{t.start();const{transform:{children:e}}=t;for(;e.length>0;){const t=e.pop();if(void 0===t)throw new Error("Error getting child");t.gameObject.start();for(const i of t.children)e.push(i)}})),this.gameLoopId=requestAnimationFrame((t=>this.gameLoop(t)))}update(t){if(!this.paused){for(;this.gameObjectsMarkedForDelete.length>0;){const t=this.gameObjectsMarkedForDelete.pop();if(void 0===t)throw new Error("Error deleting game object");this.removeReferencesToGameObject(t)}this.time.updateTime(t),this.physicsEngine.updatePhysics();for(const t of this.gameObjects)t.enabled&&t.update();this.renderingEngine.renderScene()}}gameLoop(t){this.update(t),this.gameLoopId=requestAnimationFrame((t=>this.gameLoop(t)))}}!function(t){t[t.Backspace=8]="Backspace",t[t.Tab=9]="Tab",t[t.Enter=13]="Enter",t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.PauseBreak=19]="PauseBreak",t[t.CapsLock=20]="CapsLock",t[t.Escape=27]="Escape",t[t.Space=32]="Space",t[t.PageUp=33]="PageUp",t[t.PageDown=34]="PageDown",t[t.End=35]="End",t[t.Home=36]="Home",t[t.LeftArrow=37]="LeftArrow",t[t.UpArrow=38]="UpArrow",t[t.RightArrow=39]="RightArrow",t[t.DownArrow=40]="DownArrow",t[t.Insert=45]="Insert",t[t.Delete=46]="Delete",t[t.Zero=48]="Zero",t[t.ClosedParen=48]="ClosedParen",t[t.One=49]="One",t[t.ExclamationMark=49]="ExclamationMark",t[t.Two=50]="Two",t[t.AtSign=50]="AtSign",t[t.Three=51]="Three",t[t.PoundSign=51]="PoundSign",t[t.Hash=51]="Hash",t[t.Four=52]="Four",t[t.DollarSign=52]="DollarSign",t[t.Five=53]="Five",t[t.PercentSign=53]="PercentSign",t[t.Six=54]="Six",t[t.Caret=54]="Caret",t[t.Hat=54]="Hat",t[t.Seven=55]="Seven",t[t.Ampersand=55]="Ampersand",t[t.Eight=56]="Eight",t[t.Star=56]="Star",t[t.Asterik=56]="Asterik",t[t.Nine=57]="Nine",t[t.OpenParen=57]="OpenParen",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.LeftWindowKey=91]="LeftWindowKey",t[t.RightWindowKey=92]="RightWindowKey",t[t.SelectKey=93]="SelectKey",t[t.Numpad0=96]="Numpad0",t[t.Numpad1=97]="Numpad1",t[t.Numpad2=98]="Numpad2",t[t.Numpad3=99]="Numpad3",t[t.Numpad4=100]="Numpad4",t[t.Numpad5=101]="Numpad5",t[t.Numpad6=102]="Numpad6",t[t.Numpad7=103]="Numpad7",t[t.Numpad8=104]="Numpad8",t[t.Numpad9=105]="Numpad9",t[t.Multiply=106]="Multiply",t[t.Add=107]="Add",t[t.Subtract=109]="Subtract",t[t.DecimalPoint=110]="DecimalPoint",t[t.Divide=111]="Divide",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.NumLock=144]="NumLock",t[t.ScrollLock=145]="ScrollLock",t[t.SemiColon=186]="SemiColon",t[t.Equals=187]="Equals",t[t.Comma=188]="Comma",t[t.Dash=189]="Dash",t[t.Period=190]="Period",t[t.UnderScore=189]="UnderScore",t[t.PlusSign=187]="PlusSign",t[t.ForwardSlash=191]="ForwardSlash",t[t.Tilde=192]="Tilde",t[t.GraveAccent=192]="GraveAccent",t[t.OpenBracket=219]="OpenBracket",t[t.ClosedBracket=221]="ClosedBracket",t[t.Quote=222]="Quote"}(n||(n={})),function(t){t[t.LeftMouseButton=0]="LeftMouseButton",t[t.MiddleMouseButton=1]="MiddleMouseButton",t[t.RightMouseButton=2]="RightMouseButton"}(s||(s={})),function(t){t.Unidentified="Unidentified",t.Alt="Alt",t.AltGraph="AltGraph",t.CapsLock="CapsLock",t.Control="Control",t.Fn="Fn",t.FnLock="FnLock",t.Hyper="Hyper",t.Meta="Meta",t.NumLock="NumLock",t.ScrollLock="ScrollLock",t.Shift="Shift",t.Super="Super",t.Symbol="Symbol",t.SymbolLock="SymbolLock",t.Enter="Enter",t.Tab="Tab",t.Space=" ",t.ArrowDown="ArrowDown",t.ArrowLeft="ArrowLeft",t.ArrowRight="ArrowRight",t.ArrowUp="ArrowUp",t.End="End",t.Home="Home",t.PageDown="PageDown",t.PageUp="PageUp",t.Backspace="Backspace",t.Clear="Clear",t.Copy="Copy",t.CrSel="CrSel",t.Cut="Cut",t.Delete="Delete",t.EraseEof="EraseEof",t.ExSel="ExSel",t.Insert="Insert",t.Paste="Paste",t.Redo="Redo",t.Undo="Undo",t.Accept="Accept",t.Again="Again",t.Attn="Attn",t.Cancel="Cancel",t.ContextMenu="ContextMenu",t.Escape="Escape",t.Execute="Execute",t.Find="Find",t.Finish="Finish",t.Help="Help",t.Pause="Pause",t.Play="Play",t.Props="Props",t.Select="Select",t.ZoomIn="ZoomIn",t.ZoomOut="ZoomOut",t.BrightnessDown="BrightnessDown",t.BrightnessUp="BrightnessUp",t.Eject="Eject",t.LogOff="LogOff",t.Power="Power",t.PowerOff="PowerOff",t.PrintScreen="PrintScreen",t.Hibernate="Hibernate",t.Standby="Standby",t.WakeUp="WakeUp",t.AllCandidates="AllCandidates",t.Alphanumeric="Alphanumeric",t.CodeInput="CodeInput",t.Compose="Compose",t.Convert="Convert",t.Dead="Dead",t.FinalMode="FinalMode",t.GroupFirst="GroupFirst",t.GroupLast="GroupLast",t.GroupNext="GroupNext",t.GroupPrevious="GroupPrevious",t.ModeChange="ModeChange",t.NextCandidate="NextCandidate",t.NonConvert="NonConvert",t.PreviousCandidate="PreviousCandidate",t.Process="Process",t.SingleCandidate="SingleCandidate",t.HangulMode="HangulMode",t.HanjaMode="HanjaMode",t.JunjaMode="JunjaMode",t.Eisu="Eisu",t.Hankaku="Hankaku",t.Hiragana="Hiragana",t.HiraganaKatakana="HiraganaKatakana",t.KanaMode="KanaMode",t.KanjiMode="KanjiMode",t.Katakana="Katakana",t.Romaji="Romaji",t.Zenkaku="Zenkaku",t.ZenkakuHanaku="ZenkakuHanaku",t.F1="F1",t.F2="F2",t.F3="F3",t.F4="F4",t.F5="F5",t.F6="F6",t.F7="F7",t.F8="F8",t.F9="F9",t.F10="F10",t.F11="F11",t.F12="F12",t.F13="F13",t.F14="F14",t.F15="F15",t.F16="F16",t.F17="F17",t.F18="F18",t.F19="F19",t.F20="F20",t.Soft1="Soft1",t.Soft2="Soft2",t.Soft3="Soft3",t.Soft4="Soft4",t.AppSwitch="AppSwitch",t.Call="Call",t.Camera="Camera",t.CameraFocus="CameraFocus",t.EndCall="EndCall",t.GoBack="GoBack",t.GoHome="GoHome",t.HeadsetHook="HeadsetHook",t.LastNumberRedial="LastNumberRedial",t.Notification="Notification",t.MannerMode="MannerMode",t.VoiceDial="VoiceDial",t.ChannelDown="ChannelDown",t.ChannelUp="ChannelUp",t.MediaFastForward="MediaFastForward",t.MediaPause="MediaPause",t.MediaPlay="MediaPlay",t.MediaPlayPause="MediaPlayPause",t.MediaRecord="MediaRecord",t.MediaRewind="MediaRewind",t.MediaStop="MediaStop",t.MediaTrackNext="MediaTrackNext",t.MediaTrackPrevious="MediaTrackPrevious",t.AudioBalanceLeft="AudioBalanceLeft",t.AudioBalanceRight="AudioBalanceRight",t.AudioBassDown="AudioBassDown",t.AudioBassBoostDown="AudioBassBoostDown",t.AudioBassBoostToggle="AudioBassBoostToggle",t.AudioBassBoostUp="AudioBassBoostUp",t.AudioBassUp="AudioBassUp",t.AudioFaderFront="AudioFaderFront",t.AudioFaderRear="AudioFaderRear",t.AudioSurroundModeNext="AudioSurroundModeNext",t.AudioTrebleDown="AudioTrebleDown",t.AudioTrebleUp="AudioTrebleUp",t.AudioVolumeDown="AudioVolumeDown",t.AudioVolumeMute="AudioVolumeMute",t.AudioVolumeUp="AudioVolumeUp",t.MicrophoneToggle="MicrophoneToggle",t.MicrophoneVolumeDown="MicrophoneVolumeDown",t.MicrophoneVolumeMute="MicrophoneVolumeMute",t.MicrophoneVolumeUp="MicrophoneVolumeUp",t.TV="TV",t.TV3DMode="TV3DMode",t.TVAntennaCable="TVAntennaCable",t.TVAudioDescription="TVAudioDescription",t.TVAudioDescriptionMixDown="TVAudioDescriptionMixDown",t.TVAudioDescriptionMixUp="TVAudioDescriptionMixUp",t.TVContentsMenu="TVContentsMenu",t.TVDataService="TVDataService",t.TVInput="TVInput",t.TVInputComponent1="TVInputComponent1",t.TVInputComponent2="TVInputComponent2",t.TVInputComposite1="TVInputComposite1",t.TVInputComposite2="TVInputComposite2",t.TVInputHDMI1="TVInputHDMI1",t.TVInputHDMI2="TVInputHDMI2",t.TVInputHDMI3="TVInputHDMI3",t.TVInputHDMI4="TVInputHDMI4",t.TVInputVGA1="TVInputVGA1",t.TVMediaContext="TVMediaContext",t.TVNetwork="TVNetwork",t.TVNumberEntry="TVNumberEntry",t.TVPower="TVPower",t.TVRadioService="TVRadioService",t.TVSatellite="TVSatellite",t.TVSatelliteBS="TVSatelliteBS",t.TVSatelliteCS="TVSatelliteCS",t.TVSatelliteToggle="TVSatelliteToggle",t.TVTerrestrialAnalog="TVTerrestrialAnalog",t.TVTerrestrialDigital="TVTerrestrialDigital",t.TVTimer="TVTimer",t.AVRInput="AVRInput",t.AVRPower="AVRPower",t.ColorF0Red="ColorF0Red",t.ColorF1Green="ColorF1Green",t.ColorF2Yellow="ColorF2Yellow",t.ColorF3Blue="ColorF3Blue",t.ColorF4Grey="ColorF4Grey",t.ColorF5Brown="ColorF5Brown",t.ClosedCaptionToggle="ClosedCaptionToggle",t.Dimmer="Dimmer",t.DisplaySwap="DisplaySwap",t.DVR="DVR",t.Exit="Exit",t.FavoriteClear0="FavoriteClear0",t.FavoriteClear1="FavoriteClear1",t.FavoriteClear2="FavoriteClear2",t.FavoriteClear3="FavoriteClear3",t.FavoriteRecall0="FavoriteRecall0",t.FavoriteRecall1="FavoriteRecall1",t.FavoriteRecall2="FavoriteRecall2",t.FavoriteRecall3="FavoriteRecall3",t.FavoriteStore0="FavoriteStore0",t.FavoriteStore1="FavoriteStore1",t.FavoriteStore2="FavoriteStore2",t.FavoriteStore3="FavoriteStore3",t.Guide="Guide",t.GuideNextDay="GuideNextDay",t.GuidePreviousDay="GuidePreviousDay",t.Info="Info",t.InstantReplay="InstantReplay",t.Link="Link",t.ListProgram="ListProgram",t.LiveContent="LiveContent",t.Lock="Lock",t.MediaApps="MediaApps",t.MediaAudioTrack="MediaAudioTrack",t.MediaLast="MediaLast",t.MediaSkipBackward="MediaSkipBackward",t.MediaSkipForward="MediaSkipForward",t.MediaStepBackward="MediaStepBackward",t.MediaStepForward="MediaStepForward",t.MediaTopMenu="MediaTopMenu",t.NavigateIn="NavigateIn",t.NavigateNext="NavigateNext",t.NavigateOut="NavigateOut",t.NavigatePrevious="NavigatePrevious",t.NextFavoriteChannel="NextFavoriteChannel",t.NextUserProfile="NextUserProfile",t.OnDemand="OnDemand",t.Pairing="Pairing",t.PinPDown="PinPDown",t.PinPMove="PinPMove",t.PinPToggle="PinPToggle",t.PinPUp="PinPUp",t.PlaySpeedDown="PlaySpeedDown",t.PlaySpeedReset="PlaySpeedReset",t.PlaySpeedUp="PlaySpeedUp",t.RandomToggle="RandomToggle",t.RcLowBattery="RcLowBattery",t.RecordSpeedNext="RecordSpeedNext",t.RfBypass="RfBypass",t.ScanChannelsToggle="ScanChannelsToggle",t.ScreenModeNext="ScreenModeNext",t.Settings="Settings",t.SplitScreenToggle="SplitScreenToggle",t.STBInput="STBInput",t.STBPower="STBPower",t.Subtitle="Subtitle",t.Teletext="Teletext",t.VideoModeNext="VideoModeNext",t.Wink="Wink",t.ZoomToggle="ZoomToggle",t.SpeechCorrectionList="SpeechCorrectionList",t.SpeechInputToggle="SpeechInputToggle",t.Close="Close",t.New="New",t.Open="Open",t.Print="Print",t.Save="Save",t.SpellCheck="SpellCheck",t.MailForward="MailForward",t.MailReply="MailReply",t.MailSend="MailSend",t.LaunchCalculator="LaunchCalculator",t.LaunchCalendar="LaunchCalendar",t.LaunchContacts="LaunchContacts",t.LaunchMail="LaunchMail",t.LaunchMediaPlayer="LaunchMediaPlayer",t.LaunchMusicPlayer="LaunchMusicPlayer",t.LaunchMyComputer="LaunchMyComputer",t.LaunchPhone="LaunchPhone",t.LaunchScreenSaver="LaunchScreenSaver",t.LaunchSpreadsheet="LaunchSpreadsheet",t.LaunchWebBrowser="LaunchWebBrowser",t.LaunchWebCam="LaunchWebCam",t.LaunchWordProcessor="LaunchWordProcessor",t.LaunchApplication1="LaunchApplication1",t.LaunchApplication2="LaunchApplication2",t.LaunchApplication3="LaunchApplication3",t.LaunchApplication4="LaunchApplication4",t.LaunchApplication5="LaunchApplication5",t.LaunchApplication6="LaunchApplication6",t.LaunchApplication7="LaunchApplication7",t.LaunchApplication8="LaunchApplication8",t.LaunchApplication9="LaunchApplication9",t.LaunchApplication10="LaunchApplication10",t.LaunchApplication11="LaunchApplication11",t.LaunchApplication12="LaunchApplication12",t.LaunchApplication13="LaunchApplication13",t.LaunchApplication14="LaunchApplication14",t.LaunchApplication15="LaunchApplication15",t.LaunchApplication16="LaunchApplication16",t.BrowserBack="BrowserBack",t.BrowserFavorites="BrowserFavorites",t.BrowserForward="BrowserForward",t.BrowserHome="BrowserHome",t.BrowserRefresh="BrowserRefresh",t.BrowserSearch="BrowserSearch",t.BrowserStop="BrowserStop",t.Decimal="Decimal",t.Key11="Key11",t.Key12="Key12",t.Multiply="Multiply",t.Add="Add",t.Divide="Divide",t.Subtract="Subtract",t.Separator="Separator"}(o||(o={}));class T{constructor(t,e=0){this.loop=!0,this.playToFinish=!1,this.frameIndex=0,this.timer=0,this.finalFrameComplete=!1,this.onCompleted=new l,this.frames=t,this.timeBetweenFrames=e,this.computedTimeBetweenFrames=e}get onAnimationComplete(){return this.onCompleted}get currentFrame(){return this.frames[this.frameIndex]}get isComplete(){return!this.loop&&this.finalFrameComplete}get speedPercentage(){return this.timeBetweenFrames/this.computedTimeBetweenFrames*100}set speedPercentage(t){this.computedTimeBetweenFrames=100/t*this.timeBetweenFrames}reset(){this.frameIndex=0,this.timer=0,this.finalFrameComplete=!1}updateAnimation(t){this.isComplete?this.onCompleted.publish():(this.timer+=t,this.timer<this.computedTimeBetweenFrames||(this.timer=0,this.loop||this.frameIndex!==this.frames.length-1?this.frameIndex=(this.frameIndex+1)%this.frames.length:this.finalFrameComplete=!0))}}class D{constructor(t){this.assetPool=t}getAsset(t){if(!this.assetPool.has(t))throw new Error(`Asset of key ${t} not found in the asset pool!`);return this.assetPool.get(t)}}class _{constructor(){this.audioElements=[],this.index=0}static async buildAudioClipAsync(t,e=1){const i=new _;return await i.initializeAudioClip(t,e),i}get clip(){return this.index=(this.index+1)%this.audioElements.length,this.audioElements[this.index]}async initializeAudioClip(t,e){return new Promise(((i,n)=>{const s=setTimeout((()=>n(new Error("Timeout when waiting on audio to load."))),5e3);for(let n=0;n<e;n++){const o=new Audio(t);o.onloadeddata=()=>{this.audioElements.push(o),n===e-1&&(clearTimeout(s),i())}}}))}}class I{constructor(t,e){this.color=e,this.gameCanvas=t}renderBackground(t){t.clearRect(0,0,this.gameCanvas.width,this.gameCanvas.height),t.fillStyle=this.color,t.fillRect(0,0,this.gameCanvas.width,this.gameCanvas.height)}}class O{constructor(){this.frames=new Map}static async buildSpriteSheetAsync(t,e,i,n,s){const o=new O;return void 0===n&&(n=0),void 0===s&&(s=new Map),await o.initializeSpriteSheet(t,e,i,n,s),o}getFrames(t){let e=[];if(null!=t){"number"==typeof t&&(t=[t]);for(const i of t){if(!this.frames.has(i)){console.error(`Row ${i} does not exist in this sprite sheet!`);continue}const t=this.frames.get(i);if(void 0===t)throw new Error("Error getting frames");e=[...e,...t]}}else for(const t of this.frames.values())e=[...e,...t];return e}async initializeSpriteSheet(t,e,i,n,s){return new Promise(((o,a)=>{const r=setTimeout((()=>a(new Error("Timeout when waiting on spritesheet to load."))),5e3);let h=0;for(let t=1;t<=i;t++){const i=s.get(t);h+=void 0!==i?i:e}let l=0;const c=new Image;c.src=t,c.onload=()=>{const t=c.width/e,a=c.height/i;"number"==typeof n&&(n={top:n,bottom:n,left:n,right:n});for(let d=0;d<i;d++){let i=s.get(d+1);void 0===i&&(i=e);for(let e=0;e<i;e++){const i=document.createElement("canvas");i.width=t,i.height=a;const s=i.getContext("2d");if(null===s)throw new Error("Error making context");s.drawImage(c,e*t+(n.left||0),d*a+(n.top||0),t-(n.right||0),a-(n.bottom||0),0,0,i.width,i.height);const u=new Image;u.src=i.toDataURL(),u.onload=()=>{const t=d+1,e=this.frames.get(t);void 0!==e?e.push(u):this.frames.set(t,[u]),l++,l===h&&(clearTimeout(r),o())}}}}}))}}class j{static setCursor(t){document.documentElement.style.cursor=`url('${t}'), default`}}class B extends c{constructor(t,e,i,n){super(t),this.renderWidth=e,this.halfRWidth=e/2,this.renderHeight=i,this.halfRHeight=i/2,this.animation=n}get currentAnimation(){return this.animation}setAnimation(t){this.animation.playToFinish&&!this.animation.isComplete||(this.animation=t)}render(t){t.translate(this.transform.position.x,this.transform.position.y-this.halfRHeight),t.rotate(this.transform.rotation),t.drawImage(this.animation.currentFrame,0-this.halfRWidth,0-this.halfRHeight,this.renderWidth,this.renderHeight),t.rotate(-this.transform.rotation),t.translate(-this.transform.position.x,-(this.transform.position.y-this.halfRHeight)),this.animation.updateAnimation(this.time.deltaTime)}}class G extends c{constructor(t,e){super(t),this.audioElement=e.clip,this.audioClip=e}get isPlaying(){return!this.audioElement.paused}set loop(t){this.audioElement.loop=t}set playOnStart(t){this.audioElement.autoplay=t}setClip(t){this.audioElement=t.clip,this.audioClip=t}play(){this.audioElement.play()}playOneShot(){this.audioClip.clip.play()}pause(){this.audioElement.pause()}}class K extends c{constructor(t,e){super(t),this.onClickedOn=new l,this.collider=e,this.input.addMouseListener(i.Click,0,(()=>this.handleClickEvent()))}get onClicked(){return this.onClickedOn}handleClickEvent(){const t=this.input.canvasMousePosition;R.rectangleContainsPoint(this.collider.topLeft,this.collider.bottomRight,t)&&this.onClickedOn.publish()}}class z extends c{constructor(){super(...arguments),this.zIndex=0,this.numFrames=0,this.timer=0,this.FPS=0}renderGUI(t){this.timer+=this.time.deltaTime,this.numFrames++,this.timer>=.5&&(this.FPS=this.numFrames/this.timer,this.timer=0,this.numFrames=0),t.font="20px Arial",t.fillStyle="white",t.fillText(`FPS: ${this.FPS.toFixed(2)}`,0,20)}}class N{constructor(t=!0,e){if(this.heapArray=[],this.minHeap=t,e)for(const t of e)this.add(t)}static from(t,e=!0){const i=new N(e);for(const e of t)i.add(e);return i}static isBinaryHeap(t){return N.isMaxBinaryHeap(t)||N.isMinBinaryHeap(t)}static isMinBinaryHeap(t){let e;e=t instanceof N?t.heapArray:t;for(let t=0,i=e.length;t<i;t++){const n=e[t];if(null===n)return!1;if(2*t+1<i&&e[2*t+1]<n)return!1;if(2*t+2<i&&e[2*t+2]<n)return!1}return!0}static isMaxBinaryHeap(t){let e;e=t instanceof N?t.heapArray:t;for(let t=0,i=e.length;t<i;t++){const n=e[t];if(null===n)return!1;if(2*t+1<i&&e[2*t+1]>n)return!1;if(2*t+2<i&&e[2*t+2]>n)return!1}return!0}get isEmpty(){return 0===this.heapArray.length}get count(){return this.heapArray.length}add(t){this.heapArray.push(t),this.heapifyUp()}remove(){const t=this.peek(),e=this.heapArray.pop();if(void 0===e)throw new Error("Error in binary heap");return this.count>0&&(this.heapArray[0]=e,this.heapifyDown()),t}poll(){return this.isEmpty?null:this.remove()}peek(){if(this.isEmpty)throw new Error("The heap is empty.");return this.heapArray[0]}contains(t){return this.heapArray.includes(t)}clear(){this.heapArray.length=0}toString(){return this.heapArray.toString()}toArray(){return this.heapArray}heapifyUp(){let t=this.count-1;if(this.minHeap)for(;this.hasParent(t)&&this.heapArray[t]<this.heapArray[this.getParentIndex(t)];)this.swap(t,this.getParentIndex(t)),t=this.getParentIndex(t);else for(;this.hasParent(t)&&this.heapArray[t]>this.heapArray[this.getParentIndex(t)];)this.swap(t,this.getParentIndex(t)),t=this.getParentIndex(t)}heapifyDown(){let t=0;if(this.minHeap)for(;this.hasLeftChild(t);){let e=this.getLeftChildIndex(t);if(this.hasRightChild(t)&&this.heapArray[this.getRightChildIndex(t)]<this.heapArray[e]&&(e=this.getRightChildIndex(t)),this.heapArray[t]<this.heapArray[e])break;this.swap(t,e),t=e}else for(;this.hasLeftChild(t);){let e=this.getLeftChildIndex(t);if(this.hasRightChild(t)&&this.heapArray[this.getRightChildIndex(t)]>this.heapArray[e]&&(e=this.getRightChildIndex(t)),this.heapArray[t]>this.heapArray[e])break;this.swap(t,e),t=e}}hasParent(t){return t>0}hasLeftChild(t){return this.getLeftChildIndex(t)<this.count}hasRightChild(t){return this.getRightChildIndex(t)<this.count}getParentIndex(t){return Math.floor((t-1)/2)}getLeftChildIndex(t){return Math.floor(2*t+1)}getRightChildIndex(t){return Math.floor(2*t+2)}swap(t,e){const i=this.heapArray[t];this.heapArray[t]=this.heapArray[e],this.heapArray[e]=i}}class H{constructor(t,e){this.item=t,this.priority=e}valueOf(){return this.priority}}class V{constructor(t=!0){this.elementsHeap=new N(t)}get count(){return this.elementsHeap.count}get isEmpty(){return this.elementsHeap.isEmpty}enqueue(t,e){this.elementsHeap.add(new H(t,e))}dequeue(){return this.elementsHeap.remove().item}}class U extends c{constructor(t,e){super(t),this.speed=1,this.onDirectionChanged=new l,this.onPathCompleted=new l,this.path=null,this.nextPosition=null,this.pathIndex=0,this.navGrid=e}get heading(){return null===this.nextPosition?null:d.direction(this.transform.position,this.nextPosition)}get hasPath(){return null!==this.path}get destination(){return null===this.path?null:this.path[this.path.length-1]}update(){if(null!==this.nextPosition&&null!==this.path){if(this.transform.position.isCloseTo(this.nextPosition)){if(this.pathIndex++,this.pathIndex>=this.path.length)return this.resetPath(),void this.onPathCompleted.publish();this.nextPosition=this.path[this.pathIndex],null!==this.heading&&this.onDirectionChanged.publish(this.heading)}this.transform.translate(d.direction(this.transform.position,this.nextPosition).multiplyScalar(this.speed))}}setDestination(t){this.resetPath(),this.path=class{static findPath(t,e,i){var n,s;if(t.isUnpassable(i))return null;const o=new Map,a=new Map,r=new V;for(i=i.clone(),e=e.clone(),a.set(e,0),r.enqueue(e,0);r.count>0;){const h=r.dequeue();if(h.isCloseTo(i,t.cellSize))return this.constructPath(o,h,e,i);for(const e of t.neighbors(h)){const t=1+(null!==(n=a.get(h))&&void 0!==n?n:0);if(t<(null!==(s=a.get(e.position))&&void 0!==s?s:Number.MAX_SAFE_INTEGER)){a.set(e.position,t);const n=t+this.heuristic(e.position,i);r.enqueue(e.position,n),o.set(e.position,h)}}}return null}static heuristic(t,e){return d.manhattanDistance(t,e)}static constructPath(t,e,i,n){const s=[e];for(e.equals(n)||s.unshift(n);t.has(e)&&e!==i;){const i=t.get(e);if(void 0===i)throw new Error("Error constructing A* path.");e=i,s.push(e)}return s.reverse()}}.findPath(this.navGrid,this.transform.position,t),null!==this.path&&([this.nextPosition]=this.path,this.pathIndex=0)}resetPath(){this.path=null,this.nextPosition=null,this.pathIndex=0}renderGizmo(e){if(null===this.path)return;e.beginPath();let i=!0;for(const t of this.path)i?(i=!1,e.moveTo(t.x,t.y)):e.lineTo(t.x,t.y);e.strokeStyle=t.Orange,e.stroke()}}class W extends c{constructor(t,e,i,n){super(t),this.renderWidth=e,this.renderHeight=i,this.color=n}setColor(t){this.color=t}render(t){t.fillStyle=this.color,t.fillRect(this.transform.position.x-this.renderWidth/2,this.transform.position.y-this.renderHeight,this.renderWidth,this.renderHeight)}}class $ extends c{constructor(t,e,i,n,s){super(t),this.zIndex=0,this._fillAmount=100,this.fillColor=n,this.backgroundColor=s,this.renderWidth=e,this.renderHeight=i}get fillAmount(){return this._fillAmount}set fillAmount(t){t<0?t=0:t>100&&(t=100),this._fillAmount=t}renderGUI(t){t.fillStyle=this.backgroundColor,t.fillRect(this.transform.position.x-this.renderWidth/2,this.transform.position.y-this.renderHeight,this.renderWidth,this.renderHeight);const e=this._fillAmount/100*this.renderWidth;t.fillStyle=this.fillColor,t.fillRect(this.transform.position.x-this.renderWidth/2,this.transform.position.y-this.renderHeight,e,this.renderHeight)}}class Y extends c{constructor(e,i){super(e),this.zIndex=0,this.fontSize=i.fontSize||20,this.fontFamily=i.fontFamily||"Arial",this.fontColor=i.fontColor||t.White,this.text=i.text||"",this.x=i.x||0,this.y=i.y||0}renderGUI(t){t.font=`${this.fontSize}px ${this.fontFamily}`,t.fillStyle=this.fontColor,t.fillText(this.text,this.x,this.y)}getTextWidth(t){const e=t.font;t.font=`${this.fontSize}px ${this.fontFamily}`;const i=t.measureText(this.text);return t.font=e,i.width}}class q extends y{constructor(t){super(t),this.height=t.height||50,this.width=t.width||50}buildInitialComponents(e){const i=e.width||50,n=e.height||50,s=new m(this,null,i,n),o=new W(this,i,n,t.Grey),a=new K(this,s),r=new Y(this,{fontColor:t.Amber,text:"Button",y:this.transform.position.y-n/2});return r.x=this.transform.position.x-r.getTextWidth(this.gameCanvasContext)/2,this.transform.onMoved.subscribe((()=>{r.x=this.transform.position.x-r.getTextWidth(this.gameCanvasContext)/2,r.y=this.transform.position.y-n/2})),[o,s,a,r]}getPrefabSettings(){return{x:0,y:0,rotation:0,id:"button",tag:"ui",layer:e.UI}}}const X=r.p+"assets/images/ff52f723a39cfe628d466492dd2e5c62.png";class Z extends y{buildInitialComponents(){const t=[],e=new u(this);t.push(e);const i=new m(this,e,35,35,0,-5);i.physicalMaterial=p.bouncy,t.push(i);const n=this.assetPool.getAsset("minotaurSpriteSheet").getFrames(1),s=new T(n,.1);return t.push(new B(this,75,75,s)),t}getPrefabSettings(){return{x:400,y:250,rotation:0,id:"trumpRB",tag:"trumpRB",layer:e.Default}}}const J=r.p+"assets/images/9a2940ccb5ac93664e9be5733d1f2e97.png";class Q extends c{constructor(t){super(t),this.zIndex=0,this.sceneMessage="",this.messageColor="",this.messageTimer=0,this.messageLength=0,this.gameOver=!1,this.input.addKeyListener(i.KeyDown,"1",(async()=>await this.sceneManager.loadScene(1))),this.input.addKeyListener(i.KeyDown,"2",(async()=>await this.sceneManager.loadScene(2))),this.input.addKeyListener(i.KeyDown,"3",(async()=>await this.sceneManager.loadScene(3))),this.input.addKeyListener(i.KeyDown,"p",(()=>this.printGameData())),this.input.addKeyListener(i.KeyDown,"i",(()=>this.testInstantiate())),this.input.addKeyListener(i.KeyDown,o.Escape,(()=>this.togglePause())),j.setCursor(J)}endGame(){this.togglePause(),this.gameOver=!0}showMessage(t,e,i){this.sceneMessage=t,this.messageLength=e,this.messageColor=i}renderGUI(t){this.renderGameOver(t),this.renderMessage(t)}renderGameOver(t){this.gameOver&&t.fillText("Game Over! YOU SUCK",50,50)}renderMessage(t){""!==this.sceneMessage&&(this.messageTimer+=this.time.deltaTime,t.fillStyle=this.messageColor,t.fillText(this.sceneMessage,250,250),this.messageTimer>this.messageLength&&(this.sceneMessage="",this.messageTimer=0,this.messageLength=0))}togglePause(){this.sceneManager.togglePause()}printGameData(){this.sceneManager.printGameData()}testInstantiate(){const t=this.instantiate(Z).getComponent(u);null!==t&&t.addForce(new d((Math.random()>.5?1:-1)*(1500*Math.random()),(Math.random()>.5?1:-1)*(1500*Math.random())))}}const tt=r.p+"assets/images/58e71df76f5263dcb3750b0083d205ee.png";class et extends c{constructor(t){super(t),this.changeCursor(J)}update(){const t=this.physics.pointRaycastToScreen(this.input.canvasMousePosition);t&&t.gameObject.layer===e.Hostile?this.changeCursor(tt):this.changeCursor(J)}changeCursor(t){this.currentCursor!==t&&(this.currentCursor=t,j.setCursor(t))}}class it extends y{buildInitialComponents(t){return[new Q(this),new z(this),new et(this)]}getPrefabSettings(){return{x:0,y:0,rotation:0,id:"gameManager",tag:"",layer:e.Default}}}class nt extends c{constructor(t,e){super(t),this._attackRange=75,this._attackPower=15,this._attackSpeed=1.25,this._isDead=!1,this._health=100,this._maxHealth=100,this.healthbar=null,this.onDie=new l,this.animator=e}start(){this.healthbar=this.getComponentInChildren($)}get attackPower(){return this._attackPower}get attackRange(){return this._attackRange}get attackSpeed(){return this._attackSpeed}get isDead(){return this._isDead}get health(){return this._health}get onDeath(){return this.onDie}takeDamage(t){this._health-=t,null!==this.healthbar&&(this.healthbar.fillAmount=this._health/this._maxHealth*100),this._health<=0&&this.die()}die(){this._isDead=!0,this.animator.playDeathAnimation(),this.destroy(this.gameObject,3),this.onDie.publish()}}class st extends c{constructor(t,e){super(t),this.spawnRate=10,this.spawnX=725,this.spawnY=350,this.cancelToken={cancel:!1},this.objectsToSpawn=e}start(){this.invokeRepeating((()=>this.spawn()),this.spawnRate,this.cancelToken)}stopSpawning(){this.cancelToken.cancel=!0}startSpawning(){this.cancelToken.cancel&&(this.cancelToken.cancel=!1,this.invokeRepeating((()=>this.spawn()),this.spawnRate,this.cancelToken))}toggleSpawn(){this.cancelToken.cancel?this.startSpawning():this.stopSpawning()}spawn(){const t=Math.floor(Math.random()*this.objectsToSpawn.length),e=this.objectsToSpawn[t];this.instantiate(e,new d(this.spawnX,this.spawnY))}}class ot extends c{constructor(t,e){super(t),this.audioSource=e}start(){this.destroy(this.gameObject,5),this.audioSource.play();const t=this.physics.overlapSphere(this.transform.position,150);for(const e of t){const t=e.getComponent(u);null!==t&&t.addForce(d.direction(this.transform.position,e.transform.position).multiplyScalar(1e3));const i=e.getComponent(nt);null!==i&&i.takeDamage(10)}}}class at extends y{buildInitialComponents(){const t=new T(this.assetPool.getAsset("explosionSpriteSheet").getFrames(),.04);t.loop=!1;const e=new G(this,this.assetPool.getAsset("explosionSound"));return[e,new B(this,75,75,t),new ot(this,e)]}getPrefabSettings(){return{x:0,y:0,rotation:0,id:"explosion",tag:"",layer:e.Default}}}class rt extends c{constructor(t,e){super(t),this._movementDirection=d.zero,this.collider=e,this.collider.onCollided.subscribe((t=>this.hit(t)))}get movementDirection(){return this._movementDirection.clone()}set movementDirection(t){this._movementDirection=t,this.transform.lookAt(this.input.canvasMousePosition),this.transform.rotation+=5}update(){this.transform.translate(this.movementDirection.multiplyScalar(5))}hit(t){void 0!==t&&"player"!==t.getOtherCollider(this.collider).gameObject.id&&(this.instantiate(at,this.transform.position),this.destroy(this.gameObject))}}class ht extends y{buildInitialComponents(){const t=new T(this.assetPool.getAsset("redFireball").getFrames(),.1),e=new m(this,null,20,20);e.isTrigger=!0;const i=new rt(this,e);return[new B(this,50,25,t),e,i]}getPrefabSettings(){return{x:0,y:0,rotation:0,id:"fireball",tag:"",layer:e.Default}}}class lt extends c{constructor(t,e,n,s){super(t),this.speed=5,this.xVelocity=0,this.yVelocity=0,this.jumping=!1,this.collider=e,this.animator=n,this.myStats=s,this.collider.onCollided.subscribe((t=>this.handleCollisions(t))),this.input.addKeyListener(i.KeyDown,o.Space,(()=>this.jump())),this.input.addKeyListener(i.KeyDown,"r",(()=>this.fireball())),this.input.addMouseListener(i.MouseDown,0,(()=>this.meleeAttack())),this.speed=2}start(){const t=this.getComponent(st);null!==t&&(this.input.addKeyListener(i.KeyDown,o.Backspace,(()=>t.toggleSpawn())),this.input.addKeyListener(i.KeyDown,"0",(()=>t.stopSpawning())),this.myStats.onDeath.subscribe((()=>t.stopSpawning())))}update(){this.myStats.isDead||this.move()}get isMoving(){return 0!==this.xVelocity||0!==this.yVelocity}move(){this.input.getKey("d")?this.xVelocity=1:this.input.getKey("a")?this.xVelocity=-1:this.xVelocity=0,this.input.getKey("w")?this.yVelocity=-1:this.input.getKey("s")?this.yVelocity=1:this.yVelocity=0,this.animator.playRunAnimation(this.xVelocity,this.yVelocity),this.isMoving?this.transform.translate(new d(this.xVelocity,this.yVelocity).multiplyScalar(this.speed)):this.animator.playIdleAnimation()}handleCollisions(t){if(void 0===t)throw new Error;const e=t.getOtherCollider(this.collider);if(e.isTrigger)return;const i=t.getCollisionNormalForCollider(this.collider);let n=!1;for(;this.collider.detectCollision(e);)this.transform.position.add(i),n=!0;n&&this.transform.setPosition(this.transform.position.x,this.transform.position.y)}meleeAttack(){this.animator.playRandomAttackAnimation();const t=this.physics.overlapSphere(this.transform.position,this.myStats.attackRange,e.Hostile);for(const e of t){const t=e.getComponent(nt);null!==t&&t.takeDamage(this.myStats.attackPower)}}fireball(){this.animator.playRandomAttackAnimation();const t=this.instantiate(ht,new d(this.transform.position.x,this.transform.position.y-20)).getComponent(rt);if(null===t)throw new Error("Invalid fb");t.movementDirection=d.direction(this.transform.position,this.input.canvasMousePosition)}jump(){this.jumping=!0,this.animator.playJumpAnimation()}}class ct extends y{buildInitialComponents(){return[new $(this,46,8,t.Green,t.Red)]}getPrefabSettings(){return{x:0,y:0,rotation:0,id:"healthbar",tag:"healthbar",layer:e.UI}}}class dt{constructor(t,e){this.anims=[],this.animationMap=new Map([[-1,new Map([[-1,t.upLeftAnimation],[0,t.leftAnimation],[1,t.downLeftAnimation]])],[0,new Map([[-1,t.upAnimation],[0,e],[1,t.downAnimation]])],[1,new Map([[-1,t.upRightAnimation],[0,t.rightAnimation],[1,t.downRightAnimation]])]]);for(const t of this.animationMap.values())for(const e of t.values())this.anims.push(e)}get animations(){return[...this.anims]}getDirectionalAnimation(t,e){var i;const n=null===(i=this.animationMap.get(t))||void 0===i?void 0:i.get(e);if(!n)throw new Error("No animation found!");return n}}class ut extends c{constructor(t,e,i){super(t),this.facingRight=!0,i.attackAnimations.forEach((t=>{t.animations.forEach((t=>{t.playToFinish=!0,t.loop=!1}))})),i.dieLeftAnimation.playToFinish=!0,i.dieLeftAnimation.loop=!1,i.dieRightAnimation.playToFinish=!0,i.dieRightAnimation.loop=!1,i.jumpLeftAnimation.playToFinish=!0,i.jumpLeftAnimation.loop=!1,i.jumpRightAnimation.playToFinish=!0,i.jumpRightAnimation.loop=!1,this.animator=e,this.animations=i,this.setAnimation(this.animations.idleRightAnimation)}playRandomAttackAnimation(){if(this.facingRight){const t=this.animations.attackAnimations[Math.floor(Math.random()*this.animations.attackAnimations.length)].getDirectionalAnimation(1,0);this.animator.currentAnimation!==t&&t.reset(),this.setAnimation(t)}else{const t=this.animations.attackAnimations[Math.floor(Math.random()*this.animations.attackAnimations.length)].getDirectionalAnimation(-1,0);this.animator.currentAnimation!==t&&t.reset(),this.setAnimation(t)}}playRunAnimation(t,e){const i=this.animations.runAnimations.getDirectionalAnimation(t,e);this.setAnimation(i)}playIdleAnimation(){this.facingRight?this.setAnimation(this.animations.idleRightAnimation):this.setAnimation(this.animations.idleLeftAnimation)}playJumpAnimation(){this.facingRight?(this.animations.jumpRightAnimation.reset(),this.setAnimation(this.animations.jumpRightAnimation)):(this.animations.jumpLeftAnimation.reset(),this.setAnimation(this.animations.jumpLeftAnimation))}playDeathAnimation(){this.facingRight?(this.animations.dieRightAnimation.reset(),this.setAnimation(this.animations.dieRightAnimation)):(this.animations.dieLeftAnimation.reset(),this.setAnimation(this.animations.dieLeftAnimation))}faceRight(){this.facingRight=!0}faceLeft(){this.facingRight=!1}setAnimation(t){this.animator.currentAnimation!==t&&this.animator.setAnimation(t)}}class pt extends y{buildInitialComponents(){const t=[],e=new m(this,null,30,30,0,0);e.physicalMaterial=p.bouncy,t.push(e);const i=this.assetPool.getAsset("knightIdleSpriteSheet").getFrames(1),n=new T(i,.2),s=new B(this,75,75,n);t.push(s);const o=this.assetPool.getAsset("knightSpriteSheet"),a=this.assetPool.getAsset("knightRunSpriteSheet"),r=this.assetPool.getAsset("knightIdleSpriteSheet"),h=this.assetPool.getAsset("knightAttack1SpriteSheet"),l={attackAnimations:[new dt({upAnimation:new T(h.getFrames(4),.075),upLeftAnimation:new T(h.getFrames(6),.075),upRightAnimation:new T(h.getFrames(8),.075),rightAnimation:new T(h.getFrames(3),.075),leftAnimation:new T(h.getFrames(2),.075),downAnimation:new T(h.getFrames(1),.075),downLeftAnimation:new T(h.getFrames(5),.075),downRightAnimation:new T(h.getFrames(7),.075)},new T(h.getFrames(3),.075))],runAnimations:new dt({upAnimation:new T(a.getFrames(4),.075),upLeftAnimation:new T(a.getFrames(6),.075),upRightAnimation:new T(a.getFrames(8),.075),rightAnimation:new T(a.getFrames(3),.075),leftAnimation:new T(a.getFrames(2),.075),downAnimation:new T(a.getFrames(1),.075),downLeftAnimation:new T(a.getFrames(5),.075),downRightAnimation:new T(a.getFrames(7),.075)},new T(a.getFrames(3),.075)),idleRightAnimation:new T(r.getFrames(1),.2),idleLeftAnimation:new T(r.getFrames(1),.2),jumpRightAnimation:new T(o.getFrames(12),.1),jumpLeftAnimation:new T(o.getFrames(11),.1),dieRightAnimation:new T(o.getFrames(6),.075),dieLeftAnimation:new T(o.getFrames(5),.075)},c=new ut(this,s,l);t.push(c);const d=new nt(this,c);return t.push(d),t.push(new lt(this,e,c,d)),t}getPrefabSettings(){return{x:0,y:0,rotation:0,id:"player",tag:"player",layer:e.Friendly}}buildAndReturnChildGameObjects(t){const e=new ct(t);return e.transform.setPosition(this.transform.position.x,this.transform.position.y-60),[e]}}class mt extends c{constructor(t,e,i){super(t),this.facingRight=!0,i.leftAttackAnimations.forEach((t=>{t.playToFinish=!0,t.loop=!1})),i.rightAttackAnimations.forEach((t=>{t.playToFinish=!0,t.loop=!1})),i.dieLeftAnimation.playToFinish=!0,i.dieLeftAnimation.loop=!1,i.dieRightAnimation.playToFinish=!0,i.dieRightAnimation.loop=!1,i.jumpLeftAnimation.playToFinish=!0,i.jumpLeftAnimation.loop=!1,i.jumpRightAnimation.playToFinish=!0,i.jumpRightAnimation.loop=!1,this.runAnimations=new Map([[-1,new Map([[-1,i.runUpLeftAnimation],[0,i.runLeftAnimation],[1,i.runDownLeftAnimation]])],[0,new Map([[-1,i.runUpAnimation],[0,i.idleLeftAnimation],[1,i.runDownAnimation]])],[1,new Map([[-1,i.runUpRightAnimation],[0,i.runRightAnimation],[1,i.runDownRightAnimation]])]]),this.animator=e,this.animations=i,this.setAnimation(this.animations.idleRightAnimation)}playRandomAttackAnimation(){if(this.facingRight){const t=this.animations.rightAttackAnimations[Math.floor(Math.random()*this.animations.rightAttackAnimations.length)];this.animator.currentAnimation!==t&&t.reset(),this.setAnimation(t)}else{const t=this.animations.leftAttackAnimations[Math.floor(Math.random()*this.animations.leftAttackAnimations.length)];this.animator.currentAnimation!==t&&t.reset(),this.setAnimation(t)}}playRunAnimation(t,e){var i;const n=null===(i=this.runAnimations.get(t))||void 0===i?void 0:i.get(e);if(!n)throw new Error("No animation");this.setAnimation(n)}playIdleAnimation(){this.facingRight?this.setAnimation(this.animations.idleRightAnimation):this.setAnimation(this.animations.idleLeftAnimation)}playJumpAnimation(){this.facingRight?(this.animations.jumpRightAnimation.reset(),this.setAnimation(this.animations.jumpRightAnimation)):(this.animations.jumpLeftAnimation.reset(),this.setAnimation(this.animations.jumpLeftAnimation))}playDeathAnimation(){this.facingRight?(this.animations.dieRightAnimation.reset(),this.setAnimation(this.animations.dieRightAnimation)):(this.animations.dieLeftAnimation.reset(),this.setAnimation(this.animations.dieLeftAnimation))}faceRight(){this.facingRight=!0}faceLeft(){this.facingRight=!1}setAnimation(t){this.animator.currentAnimation!==t&&this.animator.setAnimation(t)}}class gt extends c{constructor(t,e,i=100){super(t),this.gameManager=null,this._health=i,this._isDead=!1,this.audioSource=e}start(){const t=this.findGameObjectById("gameManager");if(null===t)throw new Error("Cound not find game manager");this.gameManager=t.getComponent(Q)}get health(){return this._health}get isDead(){return this._isDead}sayOuch(){this.audioSource.playOneShot()}takeDamage(t){this._health-=t,null!==this.gameManager&&this.gameManager.showMessage(`You were hit for ${t} damage!`,1,"red"),this._health<=0&&this.die()}die(){this._isDead=!0,console.log("You are dead!")}}class ft extends c{start(){this.destroy(this.gameObject,5)}onDestroy(){this.instantiate(at,this.transform.position)}}class yt extends y{buildInitialComponents(){const t=[];t.push(new W(this,15,15,"white"));const e=new u(this),i=new m(this,e,15,15);return i.physicalMaterial=p.bouncy,t.push(e),t.push(i),t.push(new ft(this)),t}getPrefabSettings(){return{x:0,y:0,rotation:0,id:"throwableBall",tag:"",layer:e.Default}}}class wt extends c{constructor(t,e,n){super(t),this.movingRight=!1,this.movingLeft=!1,this.movingUp=!1,this.movingDown=!1,this.rb=e,this.animator=n,this.input.addKeyListener(i.KeyDown,["w","a","s","d",o.Space,o.Backspace],(t=>this.onKeyDown(t))),this.input.addKeyListener(i.KeyUp,["w","a","s","d"],(t=>this.onKeyUp(t))),this.input.addMouseListener(i.MouseDown,0,(()=>this.throwBall())),this.speed=5}start(){super.start()}update(){this.movingRight?this.rb.addForce(d.right.multiplyScalar(this.speed)):this.movingLeft&&this.rb.addForce(d.left.multiplyScalar(this.speed)),this.movingUp?this.rb.addForce(d.up.multiplyScalar(this.speed)):this.movingDown&&this.rb.addForce(d.down.multiplyScalar(this.speed)),this.movingDown||this.movingUp||this.movingLeft||this.movingRight||this.animator.playIdleAnimation()}throwBall(){const t=this.instantiate(yt,new d(this.transform.position.x,this.transform.position.y-30)).getComponent(u);this.animator.playRandomAttackAnimation(),null!==t&&t.addForce(d.direction(this.transform.position,this.input.canvasMousePosition).multiplyScalar(800))}onKeyDown(t){"d"===t.key?(this.movingRight=!0,this.movingLeft=!1,this.animator.playRunAnimation(1,0)):"a"===t.key&&(this.movingRight=!1,this.movingLeft=!0,this.animator.playRunAnimation(-1,0)),"w"===t.key?(this.movingUp=!0,this.movingDown=!1,this.animator.playRunAnimation(1,0)):"s"===t.key&&(this.movingUp=!1,this.movingDown=!0,this.animator.playRunAnimation(-1,0)),t.key===o.Space&&this.rb.addForce(d.up.multiplyScalar(600)),t.key,o.Backspace}onKeyUp(t){"d"==t.key?this.movingRight=!1:"a"==t.key&&(this.movingLeft=!1),"w"==t.key?this.movingUp=!1:"s"==t.key&&(this.movingDown=!1),this.input.getKey("w")||this.input.getKey("a")||this.input.getKey("s")||this.input.getKey("d")||this.animator.playIdleAnimation()}}class bt extends y{buildInitialComponents(){const t=[],e=new u(this);t.push(e);const i=new m(this,e,35,35,0,-5);i.physicalMaterial=p.bouncy,t.push(i);const n=this.assetPool.getAsset("minotaurSpriteSheet"),s={rightAttackAnimations:[new T(n.getFrames(4),.075),new T(n.getFrames(7),.075)],leftAttackAnimations:[new T(n.getFrames(14),.075),new T(n.getFrames(17),.075)],runLeftAnimation:new T(n.getFrames(12),.075),runRightAnimation:new T(n.getFrames(2),.075),runDownAnimation:new T(n.getFrames(12),.075),runUpAnimation:new T(n.getFrames(2),.075),runUpLeftAnimation:new T(n.getFrames(12),.075),runUpRightAnimation:new T(n.getFrames(2),.075),runDownLeftAnimation:new T(n.getFrames(12),.075),runDownRightAnimation:new T(n.getFrames(2),.075),idleLeftAnimation:new T(n.getFrames(11),.075),idleRightAnimation:new T(n.getFrames(1),.075),jumpLeftAnimation:new T(n.getFrames(11),.075),jumpRightAnimation:new T(n.getFrames(1),.075),dieLeftAnimation:new T(n.getFrames(20),.075),dieRightAnimation:new T(n.getFrames(10),.075)},o=new B(this,75,75,s.idleLeftAnimation);t.push(o);const a=new mt(this,o,s);t.push(a);const r=new G(this,this.assetPool.getAsset("hurtSound"));return t.push(r),t.push(new gt(this,r)),t.push(new wt(this,e,a)),t}getPrefabSettings(){return{x:400,y:250,rotation:0,id:"player",tag:"player",layer:e.Default}}buildAndReturnChildGameObjects(t){return[]}}const St=r.p+"assets/images/0e7d4cc5e73bac9471200bddcc9b0bc1.png",At=r.p+"assets/images/98ebe55523376f2eed49ead175ed279d.png",vt=r.p+"assets/images/11be1a02bf6eafdf808bbb6c5158320f.png",Mt=r.p+"assets/images/8a44074f47e088f4fc11a40ce67f486d.png",Ct=r.p+"assets/images/08b7fc361a52efd6d25ac8e24aff67ac.png",xt=r.p+"assets/images/374523583a46ef18a9b2c73a8724e27c.png",Ft=r.p+"assets/images/6f171e0789b3acdc8f85fa361c8f2ce2.png",Et=r.p+"assets/images/a94a55389b6c8e2a9ea99f03f499ec7e.png",kt=r.p+"assets/images/90765b5e99fcca8b5d77897d6d60b083.png",Rt=r.p+"assets/images/961dc5e49a6ea004cb8bd16cd4ba796b.png",Lt=r.p+"assets/audio/851f2ee51c21a4bd77b2ea55fe4f7913.mp3",Pt=r.p+"assets/audio/b7f0dc68eed10c85ea73df299954a0b9.wav";class Tt extends c{constructor(t,e,i,n,s){super(t),this.currentTarget=null,this._myStats=e,this._searchingState=i,this._chaseState=n,this._attackState=s,this._currentState=i,i.onEnter(this)}get currentState(){return this._currentState}get searchingState(){return this._searchingState}get chaseState(){return this._chaseState}get attackState(){return this._attackState}update(){this._myStats.isDead||this._currentState.performBehavior(this)}setState(t){this._currentState.onExit(this),this._currentState=t,t.onEnter(this)}}class Dt extends c{constructor(t,e){super(t),this.timer=0,this.animator=e}performBehavior(t){if(this.timer+=this.time.deltaTime,this.timer<1)return;const e=this.findGameObjectById("player");null!==e&&(t.currentTarget=e.transform,t.setState(t.chaseState))}onEnter(t){this.animator.playIdleAnimation(),this.timer=0,t.currentTarget=null}onExit(t){this.timer=0}}class _t extends c{constructor(t,e,i,n){super(t),this.timer=0,this.targetStats=null,this.navAgent=e,this.animator=i,this.myStats=n,this.navAgent.onDirectionChanged.subscribe((t=>this.changeAnimation(t))),this.navAgent.onPathCompleted.subscribe((()=>this.animator.playIdleAnimation()))}performBehavior(t){null===t.currentTarget||null===this.targetStats||this.targetStats.isDead?t.setState(t.searchingState):d.distance(this.transform.position,t.currentTarget.position)<this.myStats.attackRange?t.setState(t.attackState):(this.timer+=this.time.deltaTime,this.timer<1||(this.timer=0,this.navAgent.setDestination(t.currentTarget.position)))}onEnter(t){const e=t.currentTarget;null!==e?this.targetStats=e.getComponent(nt):t.setState(t.searchingState)}onExit(t){this.targetStats=null}changeAnimation(t){if(void 0===t)throw new Error("Error");let e=0,i=0;t.x>.5?e=1:t.x<-.5&&(e=-1),t.y>.5?i=1:t.y<-.5&&(i=-1),this.animator.playRunAnimation(e,i)}}class It extends c{constructor(t,e,i){super(t),this.targetStats=null,this.attackTimer=0,this.animator=e,this.myStats=i}performBehavior(t){null===t.currentTarget||null===this.targetStats||this.targetStats.isDead?t.setState(t.searchingState):d.distance(this.transform.position,t.currentTarget.position)>this.myStats.attackRange?t.setState(t.chaseState):(this.attackTimer+=this.time.deltaTime,this.attackTimer<this.myStats.attackSpeed?this.animator.playIdleAnimation():(this.faceTarget(t.currentTarget),this.attackTimer=0,this.animator.playRandomAttackAnimation(),this.targetStats.takeDamage(this.myStats.attackPower)))}onEnter(t){this.attackTimer=0;const e=t.currentTarget;if(null===e)return void t.setState(t.searchingState);const i=e.getComponent(nt);null!==i?this.targetStats=i:t.setState(t.searchingState)}onExit(){this.targetStats=null}faceTarget(t){t.position.x<this.transform.position.x?this.animator.faceLeft():this.animator.faceRight()}}class Ot extends y{buildInitialComponents(){const t=[],e=new m(this,null,30,30,0,0);e.physicalMaterial=p.bouncy,t.push(e);const i=new U(this,this.terrain.navGrid);t.push(i);const n=this.assetPool.getAsset("minotaurSpriteSheet"),s={rightAttackAnimations:[new T(n.getFrames(4),.075),new T(n.getFrames(7),.075)],leftAttackAnimations:[new T(n.getFrames(14),.075),new T(n.getFrames(17),.075)],runLeftAnimation:new T(n.getFrames(12),.075),runRightAnimation:new T(n.getFrames(2),.075),runUpAnimation:new T(n.getFrames(12),.075),runDownAnimation:new T(n.getFrames(2),.075),runUpLeftAnimation:new T(n.getFrames(12),.075),runUpRightAnimation:new T(n.getFrames(2),.075),runDownLeftAnimation:new T(n.getFrames(12),.075),runDownRightAnimation:new T(n.getFrames(2),.075),idleLeftAnimation:new T(n.getFrames(11),.075),idleRightAnimation:new T(n.getFrames(1),.075),jumpLeftAnimation:new T(n.getFrames(14),.075),jumpRightAnimation:new T(n.getFrames(14),.075),dieLeftAnimation:new T(n.getFrames(20),.075),dieRightAnimation:new T(n.getFrames(10),.075)},o=new B(this,85,85,s.idleRightAnimation);t.push(o);const a=new mt(this,o,s);t.push(a);const r=new nt(this,a);t.push(r);const h=new Dt(this,a);t.push(h);const l=new _t(this,i,a,r);t.push(l);const c=new It(this,a,r);return t.push(c),t.push(new Tt(this,r,h,l,c)),t}getPrefabSettings(){return{x:200,y:300,rotation:0,id:"minotaur",tag:"",layer:e.Hostile}}buildAndReturnChildGameObjects(t){const e=new ct(t);return e.transform.setPosition(this.transform.position.x,this.transform.position.y-70),[e]}}class jt extends y{static buildBox(i,n,s,o,a,r,h,l=t.Grey){const c=new jt({gameEngine:i,id:r,x:n,y:s,rotation:0,tag:h,layer:e.Terrain}),d=c.getComponent(W);if(null===d)throw new Error("Error building box");d.renderWidth=o,d.renderHeight=a,d.color=l;const u=c.getComponent(m);if(null===u)throw new Error("Error building box");return u.width=o,u.height=a,u.physicalMaterial=p.metal,c}buildInitialComponents(){const e=new u(this,1e5,!0),i=new m(this,e,50,50);return[e,new W(this,50,50,t.Grey),i]}getPrefabSettings(){return{x:0,y:0,rotation:0,id:"borders",tag:"borders",layer:e.Terrain}}}class Bt extends y{buildInitialComponents(){return[]}getPrefabSettings(){return{x:0,y:0,rotation:0,id:"ui-canvas",tag:"ui",layer:e.UI}}buildAndReturnChildGameObjects(t){var e;const i=new q({gameEngine:t.gameEngine,id:"button1",x:150,y:150});return null===(e=i.getComponent(K))||void 0===e||e.onClicked.subscribe((()=>t.gameEngine.togglePause())),[i]}}const Gt={name:"Scene1",loadOrder:1,terrainSpec:new class{constructor(t=1){this.cellSize=16,this.scale=1,this.spriteSheetUrl=X,this.topWall={sliceX:16,sliceY:0,sliceWidth:this.cellSize,sliceHeight:this.cellSize},this.midWall={sliceX:16,sliceY:16,sliceWidth:this.cellSize,sliceHeight:this.cellSize},this.rightWall={sliceX:0,sliceY:128,sliceWidth:this.cellSize,sliceHeight:this.cellSize},this.leftWall={sliceX:16,sliceY:128,sliceWidth:this.cellSize,sliceHeight:this.cellSize},this.bottomWall={sliceX:36,sliceY:124,sliceWidth:this.cellSize,sliceHeight:this.cellSize},this.sideWallEndRight={sliceX:0,sliceY:144,sliceWidth:this.cellSize,sliceHeight:this.cellSize},this.sideWallEndLeft={sliceX:16,sliceY:144,sliceWidth:this.cellSize,sliceHeight:this.cellSize},this.floorTile={sliceX:16,sliceY:64,sliceWidth:this.cellSize,sliceHeight:this.cellSize},this.floorHole={sliceX:96,sliceY:144,sliceWidth:this.cellSize,sliceHeight:this.cellSize},this.scale=t}getSpec(){const t={spriteData:this.topWall,passable:!1,weight:0},e={spriteData:this.midWall,passable:!1,weight:0},i={spriteData:this.rightWall,passable:!1,weight:0},n={spriteData:this.leftWall,passable:!1,weight:0},s={spriteData:this.bottomWall,passable:!1,weight:0},o={spriteData:this.floorTile,passable:!0,weight:0},a={spriteData:this.sideWallEndRight,passable:!1,weight:0},r={spriteData:this.sideWallEndLeft,passable:!1,weight:0},h={spriteData:this.floorHole,passable:!1,weight:0},l=null;return[[l,l,l,t,t,t,t,t,t,t,t,t,t,l],[l,l,i,e,e,e,e,e,e,e,e,e,e,n],[l,l,i,o,o,o,o,o,o,o,o,o,o,n],[l,l,i,o,o,o,o,o,o,o,o,o,o,n],[l,l,i,o,h,o,h,o,o,o,h,o,o,n,e,e,e],[l,l,i,o,o,h,h,o,o,o,h,o,o,o,o,o,o],[l,l,i,o,o,h,h,o,h,o,h,o,o,o,o,o,o],[l,l,i,o,h,o,h,o,h,o,o,o,o,o,o,o,o],[l,l,i,o,o,o,o,o,h,o,h,h,h,n,s,s,s],[l,l,i,o,o,o,o,o,h,o,o,o,o,n],[l,l,i,o,o,o,o,o,o,o,o,o,o,n],[l,l,a,s,s,s,s,s,s,s,s,s,s,r]]}}(3),getSkybox:({gameCanvas:e})=>new I(e,t.Black),getStartingGameObjects:t=>[new it({gameEngine:t,id:"gameManager"}),new Ot({gameEngine:t,id:"minotaur"}),new pt({gameEngine:t,id:"player",x:400,y:250}),new Bt({gameEngine:t,id:"ui-canvas"})],async getAssetPool(){const t=new Map,e=new Map([[5,5],[6,5],[7,3],[8,3],[9,3],[10,3],[11,5],[12,5]]),i=new Map([[1,5],[2,8],[3,5],[5,5],[6,6],[8,3],[9,3],[10,6],[11,5],[12,8],[13,5],[15,5],[16,6],[18,3],[19,3],[20,6]]),n=await O.buildSpriteSheetAsync(St,6,16,{bottom:5,top:0,left:0,right:0},e),s=await O.buildSpriteSheetAsync(At,9,20,{bottom:25,top:0,left:0,right:0},i),o=await O.buildSpriteSheetAsync(kt,5,5),a=await O.buildSpriteSheetAsync(Rt,3,2),r=await O.buildSpriteSheetAsync(Ct,8,8),h=await O.buildSpriteSheetAsync(xt,3,8),l=await O.buildSpriteSheetAsync(Ft,3,8),c=await O.buildSpriteSheetAsync(Et,3,8),d=await _.buildAudioClipAsync(Lt,5),u=await _.buildAudioClipAsync(Pt,5);return t.set("knightSpriteSheet",n),t.set("knightRunSpriteSheet",r),t.set("knightIdleSpriteSheet",h),t.set("knightAttack1SpriteSheet",l),t.set("knightAttack2SpriteSheet",c),t.set("minotaurSpriteSheet",s),t.set("explosionSpriteSheet",o),t.set("redFireball",a),t.set("explosionSound",d),t.set("hurtSound",u),new D(t)}},Kt={name:"Scene3",loadOrder:3,terrainSpec:null,getSkybox:({gameCanvas:e})=>new I(e,t.Black),getStartingGameObjects(e){const i=jt.buildBox(e,640,50,1280,50,"topBorder","border"),n=jt.buildBox(e,640,720,1280,50,"bottomBorder","border",t.Green),s=jt.buildBox(e,25,720,50,720,"leftBorder","border"),o=jt.buildBox(e,1255,720,50,720,"rightBorder","border"),a=jt.buildBox(e,640,520,150,20,"midBox","border",t.Brown);return[new it({gameEngine:e,id:"gameManager"}),new bt({gameEngine:e,id:"player"}),i,n,s,o,a]},async getAssetPool(){const t=new Map,e=new Map([[1,5],[2,8],[3,5],[5,5],[6,6],[8,3],[9,3],[10,6],[11,5],[12,8],[13,5],[15,5],[16,6],[18,3],[19,3],[20,6]]),i=await O.buildSpriteSheetAsync(At,9,20,{bottom:25,top:0,left:0,right:0},e),n=await O.buildSpriteSheetAsync(vt,10,4),s=await O.buildSpriteSheetAsync(Mt,6,4),o=await O.buildSpriteSheetAsync(kt,5,5),a=await _.buildAudioClipAsync(Lt,5),r=await _.buildAudioClipAsync(Pt,5);return t.set("minotaurSpriteSheet",i),t.set("trumpIdleSpriteSheet",n),t.set("trumpRunSpriteSheet",s),t.set("explosionSpriteSheet",o),t.set("explosionSound",a),t.set("hurtSound",r),new D(t)}},zt=r.p+"assets/images/d0845c1200a4558cd4637f2e4c58ee45.jpg";window.onload=async()=>{await async function(){const e=document.getElementById("body"),i=document.getElementById("game-canvas");!function({style:e}){e.backgroundColor=t.BlueGrey,e.backgroundImage=`url('${zt}')`}(e),function({style:e}){e.padding="0",e.margin="auto",e.display="block",e.position="absolute",e.top="0",e.bottom="0",e.left="0",e.right="0",e.border=`2px solid ${t.RedGrey}`}(i);const n=new P({gameCanvas:i});n.developmentMode=!0,n.setScenes([Gt,Kt]),await n.loadScene(1)}()}})();
//# sourceMappingURL=bundle.js.map